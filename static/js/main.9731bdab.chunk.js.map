{"version":3,"sources":["../../../../lib/waku_relay/index.ts","../../../../src/chat/chat_message.ts","../../../../lib/waku_relay/constants.ts","../../../../../../src/proto/waku/v2/message.ts","../../../../lib/waku_relay/get_relay_peers.ts","../../../../lib/waku_relay/relay_heartbeat.ts","../../../../src/lib/waku.ts","../../../../../../src/proto/chat/v2/chat_message.ts","../../../../lib/waku_store/index.ts","../../../../lib/waku_store/history_rpc.ts","../../../../../../src/proto/waku/v2/store.ts","command.ts","ChatList.tsx","WakuContext.ts","MessageInput.tsx","Room.tsx","App.tsx","index.tsx","../../../../src/lib/waku_message.ts"],"names":["exports","message","global","transportKey","libp2p_websockets_1","default","writer","i","globalThis","handleCommand","input","waku","setNick","response","args","trim","replaceAll","split","parseInput","command","shift","map","str","push","nick","libp2p","peerId","toB58String","info","peer","peerMultiaddr","multiaddr","getPeerId","peerStore","addressBook","add","PeerId","createFromB58String","toString","e","connect","peers","forEach","addresses","replace","protocols","length","ChatList","props","messages","listItems","ListItem","ListItemText","primary","Message","timestamp","List","dense","chatMsg","toLocaleString","month","day","hour","minute","hour12","Card","className","variant","CardContent","Typography","color","style","marginLeft","component","AlwaysScrollToBottom","elementRef","useRef","useEffect","current","scrollIntoView","ref","WakuContext","createContext","undefined","useWaku","useContext","MessageInput","useState","inputText","setInputText","sendMessage","a","keyPressHandler","event","key","Grid","container","direction","alignItems","item","xs","TextField","label","value","fullWidth","InputLabelProps","shrink","onChange","target","messageHandler","onKeyPress","disabled","Button","size","onClick","Room","messageToSend","setMessageToSend","height","display","flexDirection","flexGrow","overflowY","lines","padding","handleMessage","commandHandler","relay","send","bind","messageSender","startsWith","chatMessage","ChatMessage","Date","wakuMsg","WakuMessage","fromBytes","encode","ChatContentTopic","App","stateMessages","setMessages","stateWaku","setWaku","handleNewMessages","data","decode","payload","decodeWakuMessage","copyAndReplace","pubsub","on","RelayDefaultTopic","removeListener","initWaku","then","console","log","catch","width","overflow","Provider","msg","setter","Waku","create","config","enabled","emitSelf","newValues","currentValues","slice","concat","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.9731bdab.chunk.js","sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WakuRelay = void 0;\nconst libp2p_gossipsub_1 = __importDefault(require(\"libp2p-gossipsub\"));\nconst utils_1 = require(\"libp2p-gossipsub/src/utils\");\nconst signature_policy_1 = require(\"libp2p-interfaces/src/pubsub/signature-policy\");\nconst peer_id_1 = __importDefault(require(\"peer-id\"));\nconst constants = __importStar(require(\"./constants\"));\nconst get_relay_peers_1 = require(\"./get_relay_peers\");\nconst relay_heartbeat_1 = require(\"./relay_heartbeat\");\n__exportStar(require(\"./constants\"), exports);\n__exportStar(require(\"./relay_heartbeat\"), exports);\nclass WakuRelay extends libp2p_gossipsub_1.default {\n    /**\n     *\n     * @param {Libp2p} libp2p\n     * @param {Partial<GossipOptions>} [options]\n     */\n    constructor(libp2p, options) {\n        super(libp2p, Object.assign(options, {\n            // Ensure that no signature is included nor expected in the messages.\n            globalSignaturePolicy: signature_policy_1.SignaturePolicy.StrictNoSign,\n        }));\n        this.heartbeat = new relay_heartbeat_1.RelayHeartbeat(this);\n        const multicodecs = [constants.RelayCodec];\n        Object.assign(this, { multicodecs });\n    }\n    /**\n     * Mounts the gossipsub protocol onto the libp2p node\n     * and subscribes to the default topic\n     * @override\n     * @returns {void}\n     */\n    start() {\n        super.start();\n        super.subscribe(constants.RelayDefaultTopic);\n    }\n    /**\n     * Send Waku messages under default topic\n     * @override\n     * @param {WakuMessage} message\n     * @returns {Promise<void>}\n     */\n    async send(message) {\n        const msg = message.toBinary();\n        await super.publish(constants.RelayDefaultTopic, Buffer.from(msg));\n    }\n    /**\n     * Join topic\n     * @param {string} topic\n     * @returns {void}\n     * @override\n     */\n    join(topic) {\n        var _a;\n        if (!this.started) {\n            throw new Error('WakuRelayPubsub has not started');\n        }\n        const fanoutPeers = this.fanout.get(topic);\n        if (fanoutPeers) {\n            // these peers have a score above the publish threshold, which may be negative\n            // so drop the ones with a negative score\n            fanoutPeers.forEach((id) => {\n                if (this.score.score(id) < 0) {\n                    fanoutPeers.delete(id);\n                }\n            });\n            if (fanoutPeers.size < this._options.D) {\n                // we need more peers; eager, as this would get fixed in the next heartbeat\n                get_relay_peers_1.getRelayPeers(this, topic, this._options.D - fanoutPeers.size, (id) => {\n                    // filter our current peers, direct peers, and peers with negative scores\n                    return (!fanoutPeers.has(id) &&\n                        !this.direct.has(id) &&\n                        this.score.score(id) >= 0);\n                }).forEach((id) => fanoutPeers.add(id));\n            }\n            this.mesh.set(topic, fanoutPeers);\n            this.fanout.delete(topic);\n            this.lastpub.delete(topic);\n        }\n        else {\n            const peers = get_relay_peers_1.getRelayPeers(this, topic, this._options.D, (id) => {\n                // filter direct peers and peers with negative score\n                return !this.direct.has(id) && this.score.score(id) >= 0;\n            });\n            this.mesh.set(topic, peers);\n        }\n        (_a = this.mesh.get(topic)) === null || _a === void 0 ? void 0 : _a.forEach((id) => {\n            this.log('JOIN: Add mesh link to %s in %s', id, topic);\n            this._sendGraft(id, topic);\n        });\n    }\n    /**\n     * Publish messages\n     *\n     * @override\n     * @param {InMessage} msg\n     * @returns {void}\n     */\n    async _publish(msg) {\n        if (msg.receivedFrom !== this.peerId.toB58String()) {\n            this.score.deliverMessage(msg);\n            this.gossipTracer.deliverMessage(msg);\n        }\n        const msgID = this.getMsgId(msg);\n        const msgIdStr = utils_1.messageIdToString(msgID);\n        // put in seen cache\n        this.seenCache.put(msgIdStr);\n        this.messageCache.put(msg);\n        const toSend = new Set();\n        msg.topicIDs.forEach((topic) => {\n            const peersInTopic = this.topics.get(topic);\n            if (!peersInTopic) {\n                return;\n            }\n            // direct peers\n            this.direct.forEach((id) => {\n                toSend.add(id);\n            });\n            let meshPeers = this.mesh.get(topic);\n            if (!meshPeers || !meshPeers.size) {\n                // We are not in the mesh for topic, use fanout peers\n                meshPeers = this.fanout.get(topic);\n                if (!meshPeers) {\n                    // If we are not in the fanout, then pick peers in topic above the publishThreshold\n                    const peers = get_relay_peers_1.getRelayPeers(this, topic, this._options.D, (id) => {\n                        return (this.score.score(id) >=\n                            this._options.scoreThresholds.publishThreshold);\n                    });\n                    if (peers.size > 0) {\n                        meshPeers = peers;\n                        this.fanout.set(topic, peers);\n                    }\n                    else {\n                        meshPeers = new Set();\n                    }\n                }\n                // Store the latest publishing time\n                this.lastpub.set(topic, this._now());\n            }\n            meshPeers === null || meshPeers === void 0 ? void 0 : meshPeers.forEach((peer) => {\n                toSend.add(peer);\n            });\n        });\n        // Publish messages to peers\n        const rpc = utils_1.createGossipRpc([libp2p_gossipsub_1.default.utils.normalizeOutRpcMessage(msg)]);\n        toSend.forEach((id) => {\n            if (id === msg.from) {\n                return;\n            }\n            this._sendRpc(id, rpc);\n        });\n    }\n    /**\n     * Emits gossip to peers in a particular topic\n     * @param {string} topic\n     * @param {Set<string>} exclude peers to exclude\n     * @returns {void}\n     */\n    _emitGossip(topic, exclude) {\n        const messageIDs = this.messageCache.getGossipIDs(topic);\n        if (!messageIDs.length) {\n            return;\n        }\n        // shuffle to emit in random order\n        utils_1.shuffle(messageIDs);\n        // if we are emitting more than GossipsubMaxIHaveLength ids, truncate the list\n        if (messageIDs.length > constants.RelayMaxIHaveLength) {\n            // we do the truncation (with shuffling) per peer below\n            this.log('too many messages for gossip; will truncate IHAVE list (%d messages)', messageIDs.length);\n        }\n        // Send gossip to GossipFactor peers above threshold with a minimum of D_lazy\n        // First we collect the peers above gossipThreshold that are not in the exclude set\n        // and then randomly select from that set\n        // We also exclude direct peers, as there is no reason to emit gossip to them\n        const peersToGossip = [];\n        const topicPeers = this.topics.get(topic);\n        if (!topicPeers) {\n            // no topic peers, no gossip\n            return;\n        }\n        topicPeers.forEach((id) => {\n            const peerStreams = this.peers.get(id);\n            if (!peerStreams) {\n                return;\n            }\n            if (!exclude.has(id) &&\n                !this.direct.has(id) &&\n                peerStreams.protocol == constants.RelayCodec &&\n                this.score.score(id) >= this._options.scoreThresholds.gossipThreshold) {\n                peersToGossip.push(id);\n            }\n        });\n        let target = this._options.Dlazy;\n        const factor = constants.RelayGossipFactor * peersToGossip.length;\n        if (factor > target) {\n            target = factor;\n        }\n        if (target > peersToGossip.length) {\n            target = peersToGossip.length;\n        }\n        else {\n            utils_1.shuffle(peersToGossip);\n        }\n        // Emit the IHAVE gossip to the selected peers up to the target\n        peersToGossip.slice(0, target).forEach((id) => {\n            let peerMessageIDs = messageIDs;\n            if (messageIDs.length > constants.RelayMaxIHaveLength) {\n                // shuffle and slice message IDs per peer so that we emit a different set for each peer\n                // we have enough redundancy in the system that this will significantly increase the message\n                // coverage when we do truncate\n                peerMessageIDs = utils_1.shuffle(peerMessageIDs.slice()).slice(0, constants.RelayMaxIHaveLength);\n            }\n            this._pushGossip(id, {\n                topicID: topic,\n                messageIDs: peerMessageIDs,\n            });\n        });\n    }\n    /**\n     * Make a PRUNE control message for a peer in a topic\n     * @param {string} id\n     * @param {string} topic\n     * @param {boolean} doPX\n     * @returns {ControlPrune}\n     */\n    _makePrune(id, topic, doPX) {\n        // backoff is measured in seconds\n        // RelayPruneBackoff is measured in milliseconds\n        const backoff = constants.RelayPruneBackoff / 1000;\n        const px = [];\n        if (doPX) {\n            // select peers for Peer eXchange\n            const peers = get_relay_peers_1.getRelayPeers(this, topic, constants.RelayPrunePeers, (xid) => {\n                return xid !== id && this.score.score(xid) >= 0;\n            });\n            peers.forEach((p) => {\n                // see if we have a signed record to send back; if we don't, just send\n                // the peer ID and let the pruned peer find them in the DHT -- we can't trust\n                // unsigned address records through PX anyways\n                // Finding signed records in the DHT is not supported at the time of writing in js-libp2p\n                const peerId = peer_id_1.default.createFromB58String(p);\n                px.push({\n                    peerID: peerId.toBytes(),\n                    signedPeerRecord: this._libp2p.peerStore.addressBook.getRawEnvelope(peerId),\n                });\n            });\n        }\n        return {\n            topicID: topic,\n            peers: px,\n            backoff: backoff,\n        };\n    }\n}\nexports.WakuRelay = WakuRelay;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvbGliL3dha3VfcmVsYXkvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLHdFQUF5QztBQVl6QyxzREFJb0M7QUFFcEMsb0ZBQWdGO0FBQ2hGLHNEQUE2QjtBQUk3Qix1REFBeUM7QUFDekMsdURBQWtEO0FBQ2xELHVEQUFtRDtBQUVuRCw4Q0FBNEI7QUFDNUIsb0RBQWtDO0FBeUJsQyxNQUFhLFNBQVUsU0FBUSwwQkFBUztJQUd0Qzs7OztPQUlHO0lBQ0gsWUFBWSxNQUFjLEVBQUUsT0FBZ0M7UUFDMUQsS0FBSyxDQUNILE1BQU0sRUFDTixNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRTtZQUNyQixxRUFBcUU7WUFDckUscUJBQXFCLEVBQUUsa0NBQWUsQ0FBQyxZQUFZO1NBQ3BELENBQUMsQ0FDSCxDQUFDO1FBRUYsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLGdDQUFjLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFMUMsTUFBTSxXQUFXLEdBQUcsQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLENBQUM7UUFFM0MsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsRUFBRSxXQUFXLEVBQUUsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFFRDs7Ozs7T0FLRztJQUNILEtBQUs7UUFDSCxLQUFLLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDZCxLQUFLLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO0lBQy9DLENBQUM7SUFFRDs7Ozs7T0FLRztJQUNILEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBb0I7UUFDN0IsTUFBTSxHQUFHLEdBQUcsT0FBTyxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQy9CLE1BQU0sS0FBSyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsaUJBQWlCLEVBQUUs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","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ChatMessage = void 0;\nconst minimal_1 = require(\"protobufjs/minimal\");\nconst chat_message_1 = require(\"../proto/chat/v2/chat_message\");\n// TODO: Move to waku library?\nclass ChatMessage {\n    constructor(timestamp, nick, message) {\n        this.timestamp = timestamp;\n        this.nick = nick;\n        this.message = message;\n    }\n    static decode(bytes) {\n        const protoMsg = chat_message_1.ChatMessageProto.decode(minimal_1.Reader.create(bytes));\n        const timestamp = new Date(protoMsg.timestamp * 1000);\n        const message = protoMsg.payload\n            ? Array.from(protoMsg.payload)\n                .map((char) => {\n                return String.fromCharCode(char);\n            })\n                .join('')\n            : '';\n        return new ChatMessage(timestamp, protoMsg.nick, message);\n    }\n    encode() {\n        const timestamp = Math.floor(this.timestamp.valueOf() / 1000);\n        const payload = Buffer.from(this.message, 'utf-8');\n        return chat_message_1.ChatMessageProto.encode({\n            timestamp,\n            nick: this.nick,\n            payload,\n        }).finish();\n    }\n}\nexports.ChatMessage = ChatMessage;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hhdF9tZXNzYWdlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2NoYXQvY2hhdF9tZXNzYWdlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLGdEQUE0QztBQUU1QyxnRUFBaUU7QUFFakUsOEJBQThCO0FBQzlCLE1BQWEsV0FBVztJQUN0QixZQUNTLFNBQWUsRUFDZixJQUFZLEVBQ1osT0FBZTtRQUZmLGNBQVMsR0FBVCxTQUFTLENBQU07UUFDZixTQUFJLEdBQUosSUFBSSxDQUFRO1FBQ1osWUFBTyxHQUFQLE9BQU8sQ0FBUTtJQUNyQixDQUFDO0lBRUosTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFpQjtRQUM3QixNQUFNLFFBQVEsR0FBRywrQkFBZ0IsQ0FBQyxNQUFNLENBQUMsZ0JBQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUMvRCxNQUFNLFNBQVMsR0FBRyxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxDQUFDO1FBQ3RELE1BQU0sT0FBTyxHQUFHLFFBQVEsQ0FBQyxPQUFPO1lBQzlCLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUM7aUJBQ3pCLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFO2dCQUNaLE9BQU8sTUFBTSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNuQyxDQUFDLENBQUM7aUJBQ0QsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUNiLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDUCxPQUFPLElBQUksV0FBVyxDQUFDLFNBQVMsRUFBRSxRQUFRLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQzVELENBQUM7SUFFRCxNQUFNO1FBQ0osTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFDO1FBQzlELE1BQU0sT0FBTyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQztRQUVuRCxPQUFPLCtCQUFnQixDQUFDLE1BQU0sQ0FBQztZQUM3QixTQUFTO1lBQ1QsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJO1lBQ2YsT0FBTztTQUNSLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUNkLENBQUM7Q0FDRjtBQTlCRCxrQ0E4QkMifQ==","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.RelayOpportunisticGraftPeers = exports.RelayOpportunisticGraftTicks = exports.RelayFanoutTTL = exports.RelayPruneBackoff = exports.RelayPrunePeers = exports.RelayHeartbeatInterval = exports.RelayHeartbeatInitialDelay = exports.RelayDefaultTopic = exports.RelayCodec = exports.minute = exports.second = void 0;\nexports.second = 1000;\nexports.minute = 60 * exports.second;\n/**\n * RelayCodec is the libp2p identifier for the waku relay protocol\n */\nexports.RelayCodec = '/vac/waku/relay/2.0.0-beta2';\n/**\n * RelayDefaultTopic is the default gossipsub topic to use for waku relay\n */\nexports.RelayDefaultTopic = '/waku/2/default-waku/proto';\n/**\n * GossipsubHeartbeatInitialDelay is the short delay before the heartbeat timer begins\n * after the router is initialized.\n */\nexports.RelayHeartbeatInitialDelay = 100;\n/**\n * RelayHeartbeatInterval controls the time between heartbeats.\n */\nexports.RelayHeartbeatInterval = exports.second;\n/**\n * RelayPrunePeers controls the number of peers to include in prune Peer eXchange.\n * When we prune a peer that's eligible for PX (has a good score, etc), we will try to\n * send them signed peer records for up to RelayPrunePeers other peers that we\n * know of.\n */\nexports.RelayPrunePeers = 16;\n/**\n * RelayPruneBackoff controls the backoff time for pruned peers. This is how long\n * a peer must wait before attempting to graft into our mesh again after being pruned.\n * When pruning a peer, we send them our value of RelayPruneBackoff so they know\n * the minimum time to wait. Peers running older versions may not send a backoff time,\n * so if we receive a prune message without one, we will wait at least RelayPruneBackoff\n * before attempting to re-graft.\n */\nexports.RelayPruneBackoff = exports.minute;\n/**\n * RelayFanoutTTL controls how long we keep track of the fanout state. If it's been\n * RelayFanoutTTL since we've published to a topic that we're not subscribed to,\n * we'll delete the fanout map for that topic.\n */\nexports.RelayFanoutTTL = exports.minute;\n/**\n * RelayOpportunisticGraftTicks is the number of heartbeat ticks for attempting to improve the mesh\n * with opportunistic grafting. Every RelayOpportunisticGraftTicks we will attempt to select some\n * high-scoring mesh peers to replace lower-scoring ones, if the median score of our mesh peers falls\n * below a threshold\n */\nexports.RelayOpportunisticGraftTicks = 60;\n/**\n * RelayOpportunisticGraftPeers is the number of peers to opportunistically graft.\n */\nexports.RelayOpportunisticGraftPeers = 2;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uc3RhbnRzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2xpYi93YWt1X3JlbGF5L2NvbnN0YW50cy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBYSxRQUFBLE1BQU0sR0FBRyxJQUFJLENBQUM7QUFDZCxRQUFBLE1BQU0sR0FBRyxFQUFFLEdBQUcsY0FBTSxDQUFDO0FBRWxDOztHQUVHO0FBQ1UsUUFBQSxVQUFVLEdBQUcsNkJBQTZCLENBQUM7QUFFeEQ7O0dBRUc7QUFDVSxRQUFBLGlCQUFpQixHQUFHLDRCQUE0QixDQUFDO0FBUzlEOzs7R0FHRztBQUNVLFFBQUEsMEJBQTBCLEdBQUcsR0FBRyxDQUFDO0FBRTlDOztHQUVHO0FBQ1UsUUFBQSxzQkFBc0IsR0FBRyxjQUFNLENBQUM7QUFFN0M7Ozs7O0dBS0c7QUFDVSxRQUFBLGVBQWUsR0FBRyxFQUFFLENBQUM7QUFFbEM7Ozs7Ozs7R0FPRztBQUNVLFFBQUEsaUJBQWlCLEdBQUcsY0FBTSxDQUFDO0FBRXhDOzs7O0dBSUc7QUFDVSxRQUFBLGNBQWMsR0FBRyxjQUFNLENBQUM7QUFFckM7Ozs7O0dBS0c7QUFDVSxRQUFBLDRCQUE0QixHQUFHLEVBQUUsQ0FBQztBQUUvQzs7R0FFRztBQUNVLFFBQUEsNEJBQTRCLEdBQUcsQ0FBQyxDQUFDIn0=","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WakuMessageProto = exports.protobufPackage = void 0;\n/* eslint-disable */\nconst long_1 = __importDefault(require(\"long\"));\nconst minimal_1 = __importDefault(require(\"protobufjs/minimal\"));\nexports.protobufPackage = 'waku.v2';\nconst baseWakuMessageProto = {};\nexports.WakuMessageProto = {\n    encode(message, writer = minimal_1.default.Writer.create()) {\n        if (message.payload !== undefined) {\n            writer.uint32(10).bytes(message.payload);\n        }\n        if (message.contentTopic !== undefined) {\n            writer.uint32(18).string(message.contentTopic);\n        }\n        if (message.version !== undefined) {\n            writer.uint32(24).uint32(message.version);\n        }\n        if (message.timestamp !== undefined) {\n            writer.uint32(33).double(message.timestamp);\n        }\n        return writer;\n    },\n    decode(input, length) {\n        const reader = input instanceof minimal_1.default.Reader ? input : new minimal_1.default.Reader(input);\n        let end = length === undefined ? reader.len : reader.pos + length;\n        const message = Object.assign({}, baseWakuMessageProto);\n        while (reader.pos < end) {\n            const tag = reader.uint32();\n            switch (tag >>> 3) {\n                case 1:\n                    message.payload = reader.bytes();\n                    break;\n                case 2:\n                    message.contentTopic = reader.string();\n                    break;\n                case 3:\n                    message.version = reader.uint32();\n                    break;\n                case 4:\n                    message.timestamp = reader.double();\n                    break;\n                default:\n                    reader.skipType(tag & 7);\n                    break;\n            }\n        }\n        return message;\n    },\n    fromJSON(object) {\n        const message = Object.assign({}, baseWakuMessageProto);\n        if (object.payload !== undefined && object.payload !== null) {\n            message.payload = bytesFromBase64(object.payload);\n        }\n        if (object.contentTopic !== undefined && object.contentTopic !== null) {\n            message.contentTopic = String(object.contentTopic);\n        }\n        else {\n            message.contentTopic = undefined;\n        }\n        if (object.version !== undefined && object.version !== null) {\n            message.version = Number(object.version);\n        }\n        else {\n            message.version = undefined;\n        }\n        if (object.timestamp !== undefined && object.timestamp !== null) {\n            message.timestamp = Number(object.timestamp);\n        }\n        else {\n            message.timestamp = undefined;\n        }\n        return message;\n    },\n    toJSON(message) {\n        const obj = {};\n        message.payload !== undefined &&\n            (obj.payload =\n                message.payload !== undefined\n                    ? base64FromBytes(message.payload)\n                    : undefined);\n        message.contentTopic !== undefined &&\n            (obj.contentTopic = message.contentTopic);\n        message.version !== undefined && (obj.version = message.version);\n        message.timestamp !== undefined && (obj.timestamp = message.timestamp);\n        return obj;\n    },\n    fromPartial(object) {\n        const message = Object.assign({}, baseWakuMessageProto);\n        if (object.payload !== undefined && object.payload !== null) {\n            message.payload = object.payload;\n        }\n        else {\n            message.payload = undefined;\n        }\n        if (object.contentTopic !== undefined && object.contentTopic !== null) {\n            message.contentTopic = object.contentTopic;\n        }\n        else {\n            message.contentTopic = undefined;\n        }\n        if (object.version !== undefined && object.version !== null) {\n            message.version = object.version;\n        }\n        else {\n            message.version = undefined;\n        }\n        if (object.timestamp !== undefined && object.timestamp !== null) {\n            message.timestamp = object.timestamp;\n        }\n        else {\n            message.timestamp = undefined;\n        }\n        return message;\n    },\n};\nvar globalThis = (() => {\n    if (typeof globalThis !== 'undefined')\n        return globalThis;\n    if (typeof self !== 'undefined')\n        return self;\n    if (typeof window !== 'undefined')\n        return window;\n    if (typeof global !== 'undefined')\n        return global;\n    throw 'Unable to locate global object';\n})();\nconst atob = globalThis.atob ||\n    ((b64) => globalThis.Buffer.from(b64, 'base64').toString('binary'));\nfunction bytesFromBase64(b64) {\n    const bin = atob(b64);\n    const arr = new Uint8Array(bin.length);\n    for (let i = 0; i < bin.length; ++i) {\n        arr[i] = bin.charCodeAt(i);\n    }\n    return arr;\n}\nconst btoa = globalThis.btoa ||\n    ((bin) => globalThis.Buffer.from(bin, 'binary').toString('base64'));\nfunction base64FromBytes(arr) {\n    const bin = [];\n    for (let i = 0; i < arr.byteLength; ++i) {\n        bin.push(String.fromCharCode(arr[i]));\n    }\n    return btoa(bin.join(''));\n}\nif (minimal_1.default.util.Long !== long_1.default) {\n    minimal_1.default.util.Long = long_1.default;\n    minimal_1.default.configure();\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVzc2FnZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9wcm90by93YWt1L3YyL21lc3NhZ2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsb0JBQW9CO0FBQ3BCLGdEQUF3QjtBQUN4QixpRUFBcUM7QUFFeEIsUUFBQSxlQUFlLEdBQUcsU0FBUyxDQUFDO0FBU3pDLE1BQU0sb0JBQW9CLEdBQVcsRUFBRSxDQUFDO0FBRTNCLFFBQUEsZ0JBQWdCLEdBQUc7SUFDOUIsTUFBTSxDQUNKLE9BQXlCLEVBQ3pCLFNBQXFCLGlCQUFHLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRTtRQUV4QyxJQUFJLE9BQU8sQ0FBQyxPQUFPLEtBQUssU0FBUyxFQUFFO1lBQ2pDLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztTQUMxQztRQUNELElBQUksT0FBTyxDQUFDLFlBQVksS0FBSyxTQUFTLEVBQUU7WUFDdEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO1NBQ2hEO1FBQ0QsSUFBSSxPQUFPLENBQUMsT0FBTyxLQUFLLFNBQVMsRUFBRTtZQUNqQyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7U0FDM0M7UUFDRCxJQUFJLE9BQU8sQ0FBQyxTQUFTLEtBQUssU0FBUyxFQUFFO1lBQ25DLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztTQUM3QztRQUNELE9BQU8sTUFBTSxDQUFDO0lBQ2hCLENBQUM7SUFFRCxNQUFNLENBQUMsS0FBOEIsRUFBRSxNQUFlO1FBQ3BELE1BQU0sTUFBTSxHQUFHLEtB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","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getRelayPeers = void 0;\nconst utils_1 = require(\"libp2p-gossipsub/src/utils\");\nconst index_1 = require(\"./index\");\n/**\n * Given a topic, returns up to count peers subscribed to that topic\n * that pass an optional filter function\n *\n * @param {Gossipsub} router\n * @param {String} topic\n * @param {Number} count\n * @param {Function} [filter] a function to filter acceptable peers\n * @returns {Set<string>}\n *\n */\nfunction getRelayPeers(router, topic, count, filter = () => true) {\n    const peersInTopic = router.topics.get(topic);\n    if (!peersInTopic) {\n        return new Set();\n    }\n    // Adds all peers using our protocol\n    // that also pass the filter function\n    let peers = [];\n    peersInTopic.forEach((id) => {\n        const peerStreams = router.peers.get(id);\n        if (!peerStreams) {\n            return;\n        }\n        if (peerStreams.protocol == index_1.RelayCodec && filter(id)) {\n            peers.push(id);\n        }\n    });\n    // Pseudo-randomly shuffles peers\n    peers = utils_1.shuffle(peers);\n    if (count > 0 && peers.length > count) {\n        peers = peers.slice(0, count);\n    }\n    return new Set(peers);\n}\nexports.getRelayPeers = getRelayPeers;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2V0X3JlbGF5X3BlZXJzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2xpYi93YWt1X3JlbGF5L2dldF9yZWxheV9wZWVycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFDQSxzREFBcUQ7QUFFckQsbUNBQXFDO0FBRXJDOzs7Ozs7Ozs7O0dBVUc7QUFDSCxTQUFnQixhQUFhLENBQzNCLE1BQWlCLEVBQ2pCLEtBQWEsRUFDYixLQUFhLEVBQ2IsU0FBa0MsR0FBRyxFQUFFLENBQUMsSUFBSTtJQUU1QyxNQUFNLFlBQVksR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUM5QyxJQUFJLENBQUMsWUFBWSxFQUFFO1FBQ2pCLE9BQU8sSUFBSSxHQUFHLEVBQUUsQ0FBQztLQUNsQjtJQUVELG9DQUFvQztJQUNwQyxxQ0FBcUM7SUFDckMsSUFBSSxLQUFLLEdBQWEsRUFBRSxDQUFDO0lBQ3pCLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFVLEVBQUUsRUFBRTtRQUNsQyxNQUFNLFdBQVcsR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUN6QyxJQUFJLENBQUMsV0FBVyxFQUFFO1lBQ2hCLE9BQU87U0FDUjtRQUNELElBQUksV0FBVyxDQUFDLFFBQVEsSUFBSSxrQkFBVSxJQUFJLE1BQU0sQ0FBQyxFQUFFLENBQUMsRUFBRTtZQUNwRCxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1NBQ2hCO0lBQ0gsQ0FBQyxDQUFDLENBQUM7SUFFSCxpQ0FBaUM7SUFDakMsS0FBSyxHQUFHLGVBQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN2QixJQUFJLEtBQUssR0FBRyxDQUFDLElBQUksS0FBSyxDQUFDLE1BQU0sR0FBRyxLQUFLLEVBQUU7UUFDckMsS0FBSyxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO0tBQy9CO0lBRUQsT0FBTyxJQUFJLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUN4QixDQUFDO0FBL0JELHNDQStCQyJ9","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.RelayHeartbeat = void 0;\nconst heartbeat_1 = require(\"libp2p-gossipsub/src/heartbeat\");\nconst utils_1 = require(\"libp2p-gossipsub/src/utils\");\nconst constants = __importStar(require(\"./constants\"));\nconst get_relay_peers_1 = require(\"./get_relay_peers\");\nclass RelayHeartbeat extends heartbeat_1.Heartbeat {\n    /**\n     * @param {Object} gossipsub\n     * @constructor\n     */\n    constructor(gossipsub) {\n        super(gossipsub);\n    }\n    start() {\n        if (this._heartbeatTimer) {\n            return;\n        }\n        const heartbeat = this._heartbeat.bind(this);\n        const timeout = setTimeout(() => {\n            var _a;\n            heartbeat();\n            (_a = this._heartbeatTimer) === null || _a === void 0 ? void 0 : _a.runPeriodically(heartbeat, constants.RelayHeartbeatInterval);\n        }, constants.RelayHeartbeatInitialDelay);\n        this._heartbeatTimer = {\n            _intervalId: undefined,\n            runPeriodically: (fn, period) => {\n                this._heartbeatTimer._intervalId = setInterval(fn, period);\n            },\n            cancel: () => {\n                var _a;\n                clearTimeout(timeout);\n                clearInterval((_a = this._heartbeatTimer) === null || _a === void 0 ? void 0 : _a._intervalId);\n            },\n        };\n    }\n    /**\n     * Unmounts the gossipsub protocol and shuts down every connection\n     * @override\n     * @returns {void}\n     */\n    stop() {\n        if (!this._heartbeatTimer) {\n            return;\n        }\n        this._heartbeatTimer.cancel();\n        this._heartbeatTimer = null;\n    }\n    /**\n     * Maintains the mesh and fanout maps in gossipsub.\n     *\n     * @returns {void}\n     */\n    _heartbeat() {\n        const { D, Dlo, Dhi, Dscore, Dout } = this.gossipsub._options;\n        this.gossipsub.heartbeatTicks++;\n        // cache scores through the heartbeat\n        const scores = new Map();\n        const getScore = (id) => {\n            let s = scores.get(id);\n            if (s === undefined) {\n                s = this.gossipsub.score.score(id);\n                scores.set(id, s);\n            }\n            return s;\n        };\n        // peer id => topic[]\n        const toGraft = new Map();\n        // peer id => topic[]\n        const toPrune = new Map();\n        // peer id => don't px\n        const noPX = new Map();\n        // clean up expired backoffs\n        this.gossipsub._clearBackoff();\n        // clean up peerhave/iasked counters\n        this.gossipsub.peerhave.clear();\n        this.gossipsub.iasked.clear();\n        // apply IWANT request penalties\n        this.gossipsub._applyIwantPenalties();\n        // ensure direct peers are connected\n        this.gossipsub._directConnect();\n        // maintain the mesh for topics we have joined\n        this.gossipsub.mesh.forEach((peers, topic) => {\n            // prune/graft helper functions (defined per topic)\n            const prunePeer = (id) => {\n                this.gossipsub.log('HEARTBEAT: Remove mesh link to %s in %s', id, topic);\n                // update peer score\n                this.gossipsub.score.prune(id, topic);\n                // add prune backoff record\n                this.gossipsub._addBackoff(id, topic);\n                // remove peer from mesh\n                peers.delete(id);\n                // add to toPrune\n                const topics = toPrune.get(id);\n                if (!topics) {\n                    toPrune.set(id, [topic]);\n                }\n                else {\n                    topics.push(topic);\n                }\n            };\n            const graftPeer = (id) => {\n                this.gossipsub.log('HEARTBEAT: Add mesh link to %s in %s', id, topic);\n                // update peer score\n                this.gossipsub.score.graft(id, topic);\n                // add peer to mesh\n                peers.add(id);\n                // add to toGraft\n                const topics = toGraft.get(id);\n                if (!topics) {\n                    toGraft.set(id, [topic]);\n                }\n                else {\n                    topics.push(topic);\n                }\n            };\n            // drop all peers with negative score, without PX\n            peers.forEach((id) => {\n                const score = getScore(id);\n                if (score < 0) {\n                    this.gossipsub.log('HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s', id, score, topic);\n                    prunePeer(id);\n                    noPX.set(id, true);\n                }\n            });\n            // do we have enough peers?\n            if (peers.size < Dlo) {\n                const backoff = this.gossipsub.backoff.get(topic);\n                const ineed = D - peers.size;\n                const peersSet = get_relay_peers_1.getRelayPeers(this.gossipsub, topic, ineed, (id) => {\n                    // filter out mesh peers, direct peers, peers we are backing off, peers with negative score\n                    return (!peers.has(id) &&\n                        !this.gossipsub.direct.has(id) &&\n                        (!backoff || !backoff.has(id)) &&\n                        getScore(id) >= 0);\n                });\n                peersSet.forEach(graftPeer);\n            }\n            // do we have to many peers?\n            if (peers.size > Dhi) {\n                let peersArray = Array.from(peers);\n                // sort by score\n                peersArray.sort((a, b) => getScore(b) - getScore(a));\n                // We keep the first D_score peers by score and the remaining up to D randomly\n                // under the constraint that we keep D_out peers in the mesh (if we have that many)\n                peersArray = peersArray\n                    .slice(0, Dscore)\n                    .concat(utils_1.shuffle(peersArray.slice(Dscore)));\n                // count the outbound peers we are keeping\n                let outbound = 0;\n                peersArray.slice(0, D).forEach((p) => {\n                    if (this.gossipsub.outbound.get(p)) {\n                        outbound++;\n                    }\n                });\n                // if it's less than D_out, bubble up some outbound peers from the random selection\n                if (outbound < Dout) {\n                    const rotate = (i) => {\n                        // rotate the peersArray to the right and put the ith peer in the front\n                        const p = peersArray[i];\n                        for (let j = i; j > 0; j--) {\n                            peersArray[j] = peersArray[j - 1];\n                        }\n                        peersArray[0] = p;\n                    };\n                    // first bubble up all outbound peers already in the selection to the front\n                    if (outbound > 0) {\n                        let ihave = outbound;\n                        for (let i = 1; i < D && ihave > 0; i++) {\n                            if (this.gossipsub.outbound.get(peersArray[i])) {\n                                rotate(i);\n                                ihave--;\n                            }\n                        }\n                    }\n                    // now bubble up enough outbound peers outside the selection to the front\n                    let ineed = D - outbound;\n                    for (let i = D; i < peersArray.length && ineed > 0; i++) {\n                        if (this.gossipsub.outbound.get(peersArray[i])) {\n                            rotate(i);\n                            ineed--;\n                        }\n                    }\n                }\n                // prune the excess peers\n                peersArray.slice(D).forEach(prunePeer);\n            }\n            // do we have enough outbound peers?\n            if (peers.size >= Dlo) {\n                // count the outbound peers we have\n                let outbound = 0;\n                peers.forEach((p) => {\n                    if (this.gossipsub.outbound.get(p)) {\n                        outbound++;\n                    }\n                });\n                // if it's less than D_out, select some peers with outbound connections and graft them\n                if (outbound < Dout) {\n                    const ineed = Dout - outbound;\n                    const backoff = this.gossipsub.backoff.get(topic);\n                    get_relay_peers_1.getRelayPeers(this.gossipsub, topic, ineed, (id) => {\n                        // filter our current mesh peers, direct peers, peers we are backing off, peers with negative score\n                        return (!peers.has(id) &&\n                            !this.gossipsub.direct.has(id) &&\n                            (!backoff || !backoff.has(id)) &&\n                            getScore(id) >= 0);\n                    }).forEach(graftPeer);\n                }\n            }\n            // should we try to improve the mesh with opportunistic grafting?\n            if (this.gossipsub.heartbeatTicks %\n                constants.RelayOpportunisticGraftTicks ===\n                0 &&\n                peers.size > 1) {\n                // Opportunistic grafting works as follows: we check the median score of peers in the\n                // mesh; if this score is below the opportunisticGraftThreshold, we select a few peers at\n                // random with score over the median.\n                // The intention is to (slowly) improve an under performing mesh by introducing good\n                // scoring peers that may have been gossiping at us. This allows us to get out of sticky\n                // situations where we are stuck with poor peers and also recover from churn of good peers.\n                // now compute the median peer score in the mesh\n                const peersList = Array.from(peers).sort((a, b) => getScore(a) - getScore(b));\n                const medianIndex = peers.size / 2;\n                const medianScore = getScore(peersList[medianIndex]);\n                // if the median score is below the threshold, select a better peer (if any) and GRAFT\n                if (medianScore <\n                    this.gossipsub._options.scoreThresholds.opportunisticGraftThreshold) {\n                    const backoff = this.gossipsub.backoff.get(topic);\n                    const peersToGraft = get_relay_peers_1.getRelayPeers(this.gossipsub, topic, constants.RelayOpportunisticGraftPeers, (id) => {\n                        // filter out current mesh peers, direct peers, peers we are backing off, peers below or at threshold\n                        return (peers.has(id) &&\n                            !this.gossipsub.direct.has(id) &&\n                            (!backoff || !backoff.has(id)) &&\n                            getScore(id) > medianScore);\n                    });\n                    peersToGraft.forEach((id) => {\n                        this.gossipsub.log('HEARTBEAT: Opportunistically graft peer %s on topic %s', id, topic);\n                        graftPeer(id);\n                    });\n                }\n            }\n            // 2nd arg are mesh peers excluded from gossip. We have already pushed\n            // messages to them, so its redundant to gossip IHAVEs.\n            this.gossipsub._emitGossip(topic, peers);\n        });\n        // expire fanout for topics we haven't published to in a while\n        const now = this.gossipsub._now();\n        this.gossipsub.lastpub.forEach((lastpub, topic) => {\n            if (lastpub + constants.RelayFanoutTTL < now) {\n                this.gossipsub.fanout.delete(topic);\n                this.gossipsub.lastpub.delete(topic);\n            }\n        });\n        // maintain our fanout for topics we are publishing but we have not joined\n        this.gossipsub.fanout.forEach((fanoutPeers, topic) => {\n            // checks whether our peers are still in the topic and have a score above the publish threshold\n            const topicPeers = this.gossipsub.topics.get(topic);\n            fanoutPeers.forEach((id) => {\n                if (!(topicPeers === null || topicPeers === void 0 ? void 0 : topicPeers.has(id)) ||\n                    getScore(id) <\n                        this.gossipsub._options.scoreThresholds.publishThreshold) {\n                    fanoutPeers.delete(id);\n                }\n            });\n            // do we need more peers?\n            if (fanoutPeers.size < D) {\n                const ineed = D - fanoutPeers.size;\n                const peersSet = get_relay_peers_1.getRelayPeers(this.gossipsub, topic, ineed, (id) => {\n                    // filter out existing fanout peers, direct peers, and peers with score above the publish threshold\n                    return (!fanoutPeers.has(id) &&\n                        !this.gossipsub.direct.has(id) &&\n                        getScore(id) >=\n                            this.gossipsub._options.scoreThresholds.publishThreshold);\n                });\n                peersSet.forEach((id) => {\n                    fanoutPeers.add(id);\n                });\n            }\n            // 2nd arg are fanout peers excluded from gossip.\n            // We have already pushed messages to them, so its redundant to gossip IHAVEs\n            this.gossipsub._emitGossip(topic, fanoutPeers);\n        });\n        // send coalesced GRAFT/PRUNE messages (will piggyback gossip)\n        this.gossipsub._sendGraftPrune(toGraft, toPrune, noPX);\n        // flush pending gossip that wasn't piggybacked above\n        this.gossipsub._flush();\n        // advance the message history window\n        this.gossipsub.messageCache.shift();\n        this.gossipsub.emit('gossipsub:heartbeat');\n    }\n}\nexports.RelayHeartbeat = RelayHeartbeat;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVsYXlfaGVhcnRiZWF0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2xpYi93YWt1X3JlbGF5L3JlbGF5X2hlYXJ0YmVhdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQ0EsOERBQTJEO0FBQzNELHNEQUFxRDtBQUVyRCx1REFBeUM7QUFDekMsdURBQWtEO0FBRWxELE1BQWEsY0FBZSxTQUFRLHFCQUFTO0lBQzNDOzs7T0FHRztJQUNILFlBQVksU0FBb0I7UUFDOUIsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQ25CLENBQUM7SUFFRCxLQUFLO1FBQ0gsSUFBSSxJQUFJLENBQUMsZUFBZSxFQUFFO1lBQ3hCLE9BQU87U0FDUjtRQUVELE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRTdDLE1BQU0sT0FBTyxHQUFHLFVBQVUsQ0FBQyxHQUFHLEVBQUU7O1lBQzlCLFNBQVMsRUFBRSxDQUFDO1lBQ1osTUFBQSxJQUFJLENBQUMsZUFBZSwwQ0FBRSxlQUFlLENBQ25DLFNBQVMsRUFDVCxTQUFTLENBQUMsc0JBQXNCLENBQ2pDLENBQUM7UUFDSixDQUFDLEVBQUUsU0FBUyxDQUFDLDBCQUEwQixDQUFDLENBQUM7UUFFekMsSUFBSSxDQUFDLGVBQWUsR0FBRztZQUNyQixXQUFXLEVBQUUsU0FBUztZQUN0QixlQUFlLEVBQUUsQ0FBQyxFQUFFLEVBQUUsTUFBTSxFQUFFLEVBQUU7Z0JBQzlCLElBQUksQ0FBQyxlQUFnQixDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUMsRUFBRSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBQzlELENBQUM7WUFDRCxNQUFNLEVBQUUsR0FBRyxFQUFFOztnQkFDWCxZQUFZLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQ3RCLGFBQWEsQ0FBQyxNQUFBLElBQUksQ0FBQyxlQUFlLDBDQUFFLFdB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","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst libp2p_1 = __importDefault(require(\"libp2p\"));\nconst libp2p_mplex_1 = __importDefault(require(\"libp2p-mplex\"));\nconst noise_1 = require(\"libp2p-noise/dist/src/noise\");\nconst libp2p_websockets_1 = __importDefault(require(\"libp2p-websockets\"));\nconst filters_1 = __importDefault(require(\"libp2p-websockets/src/filters\"));\nconst waku_relay_1 = require(\"./waku_relay\");\nconst waku_store_1 = require(\"./waku_store\");\nconst transportKey = libp2p_websockets_1.default.prototype[Symbol.toStringTag];\nclass Waku {\n    constructor(libp2p, store) {\n        this.libp2p = libp2p;\n        this.relay = libp2p.pubsub;\n        this.store = store;\n    }\n    /**\n     * Create new waku node\n     * @param listenAddresses: Array of Multiaddrs on which the node should listen.\n     * If not present, the node is dial only.\n     * @param staticNoiseKey: A static key to use for noise,\n     * mainly used for test to reduce entropy usage.\n     * @throws If\n     * @returns {Promise<Waku>}\n     */\n    static async create(options) {\n        var _a, _b;\n        const opts = Object.assign({\n            listenAddresses: [],\n            staticNoiseKey: undefined,\n        }, options);\n        opts.config = Object.assign({\n            transport: {\n                [transportKey]: {\n                    filter: filters_1.default.all,\n                },\n            },\n        }, options.config);\n        opts.modules = Object.assign({}, options.modules);\n        let transport = [libp2p_websockets_1.default];\n        if ((_a = opts.modules) === null || _a === void 0 ? void 0 : _a.transport) {\n            transport = transport.concat((_b = opts.modules) === null || _b === void 0 ? void 0 : _b.transport);\n        }\n        // FIXME: By controlling the creation of libp2p we have to think about what\n        // needs to be exposed and what does not. Ideally, we should be able to let\n        // the user create the WakuStore, WakuRelay instances and pass them when\n        // creating the libp2p instance.\n        const libp2p = await libp2p_1.default.create({\n            addresses: {\n                listen: opts.listenAddresses,\n            },\n            modules: {\n                transport,\n                streamMuxer: [libp2p_mplex_1.default],\n                connEncryption: [new noise_1.Noise(opts.staticNoiseKey)],\n                // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n                // @ts-ignore: Type needs update\n                pubsub: waku_relay_1.WakuRelay,\n            },\n            config: opts.config,\n        });\n        const wakuStore = new waku_store_1.WakuStore(libp2p);\n        await libp2p.start();\n        return new Waku(libp2p, wakuStore);\n    }\n    /**\n     * Dials to the provided peer.\n     * @param peer The peer to dial\n     */\n    async dial(peer) {\n        await this.libp2p.dialProtocol(peer, [waku_relay_1.RelayCodec, waku_store_1.StoreCodec]);\n    }\n    async dialWithMultiAddr(peerId, multiaddr) {\n        this.libp2p.peerStore.addressBook.set(peerId, multiaddr);\n    }\n    async stop() {\n        await this.libp2p.stop();\n    }\n    /**\n     * Return the local multiaddr with peer id on which libp2p is listening.\n     * @throws if libp2p is not listening on localhost\n     */\n    getLocalMultiaddrWithID() {\n        const localMultiaddr = this.libp2p.multiaddrs.find((addr) => addr.toString().match(/127\\.0\\.0\\.1/));\n        if (!localMultiaddr || localMultiaddr.toString() === '') {\n            throw 'Not listening on localhost';\n        }\n        const multiAddrWithId = localMultiaddr + '/p2p/' + this.libp2p.peerId.toB58String();\n        return multiAddrWithId;\n    }\n}\nexports.default = Waku;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2FrdS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9saWIvd2FrdS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLG9EQUE0RTtBQUM1RSxnRUFBaUM7QUFFakMsdURBQW9EO0FBQ3BELDBFQUEyQztBQUMzQyw0RUFBb0Q7QUFJcEQsNkNBQXFEO0FBQ3JELDZDQUFxRDtBQUVyRCxNQUFNLFlBQVksR0FBRywyQkFBVSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUM7QUFXOUQsTUFBcUIsSUFBSTtJQUt2QixZQUFvQixNQUFjLEVBQUUsS0FBZ0I7UUFDbEQsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFDckIsSUFBSSxDQUFDLEtBQUssR0FBSSxNQUFNLENBQUMsTUFBK0IsQ0FBQztRQUNyRCxJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztJQUNyQixDQUFDO0lBRUQ7Ozs7Ozs7O09BUUc7SUFDSCxNQUFNLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxPQUErQjs7UUFDakQsTUFBTSxJQUFJLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FDeEI7WUFDRSxlQUFlLEVBQUUsRUFBRTtZQUNuQixjQUFjLEVBQUUsU0FBUztTQUMxQixFQUNELE9BQU8sQ0FDUixDQUFDO1FBRUYsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUN6QjtZQUNFLFNBQVMsRUFBRTtnQkFDVCxDQUFDLFlBQVksQ0FBQyxFQUFFO29CQUNkLE1BQU0sRUFBRSxpQkFBTyxDQUFDLEdBQUc7aUJBQ3BCO2FBQ0Y7U0FDRixFQUNELE9BQU8sQ0FBQyxNQUFNLENBQ2YsQ0FBQztRQUVGLElBQUksQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBRWxELElBQUksU0FBUyxHQUFHLENBQUMsMkJBQVUsQ0FBQyxDQUFDO1FBQzdCLElBQUksTUFBQSxJQUFJLENBQUMsT0FBTywwQ0FBRSxTQUFTLEVBQUU7WUFDM0IsU0FBUyxHQUFHLFNBQVMsQ0FBQyxNQUFNLENBQUMsTUFBQSxJQUFJLENBQUMsT0FBTywwQ0FBRSxTQUFTLENBQUMsQ0FBQztTQUN2RDtRQUVELDJFQUEyRTtRQUMzRSwyRUFBMkU7UUFDM0Usd0VBQXdFO1FBQ3hFLGdDQUFnQztRQUNoQyxNQUFNLE1BQU0sR0FBRyxNQUFNLGdCQUFNLENBQUMsTUFBTSxDQUFDO1lBQ2pDLFNBQVMsRUFBRTtnQkFDVCxNQUFNLEVBQUUsSUFBSSxDQUFDLGVBQWU7YUFDN0I7WUFDRCxPQUFPLEVBQUU7Z0JBQ1AsU0FBUztnQkFDVCxXQUFXLEVBQUUsQ0FBQyxzQkFBSyxDQUFDO2dCQUNwQixjQUFjLEVBQUUsQ0FBQyxJQUFJLGFBQUssQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7Z0JBQ2hELDZEQUE2RDtnQkFDN0QsZ0NBQWdDO2dCQUNoQyxNQUFNLEVBQUUsc0JBQVM7YUFDbEI7WUFDRCxNQUFNLEVBQUUsSUFBSSxDQUFDLE1BQU07U0FDcEIsQ0FBQyxDQUFDO1FBRUgsTUFBTSxTQUFTLEdBQUcsSUFBSSxzQkFBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBRXhDLE1BQU0sTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBRXJCLE9BQU8sSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFLFNBQVMsQ0FBQyxDQUFDO0lBQ3JDLENBQUM7SUFFRDs7O09BR0c7SUFDSCxLQUFLLENBQUMsSUFBSSxDQUFDLElBQWlDO1FBQzFDLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLENBQUMsdUJBQVUsRUFBRSx1QkFBVSxDQUFDLENBQUMsQ0FBQztJQUNqRSxDQUFDO0lBRUQsS0FBSyxDQUFDLGlCQUFpQixDQUFDLE1BQWMsRUFBRSxTQUFzQjtRQUM1RCxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSxTQUFTLENBQUMsQ0FBQztJQUMzRCxDQUFDO0lBRUQsS0FBSyxDQUFDLElBQUk7UUFDUixNQUFNLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDM0IsQ0FBQztJQUVEOzs7T0FHRztJQUNILHVCQUF1QjtRQUNyQixNQUFNLGNBQWMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUMxRCxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUN0QyxDQUFDO1FBQ0YsSUFBSSxDQUFDLGNBQWMsSUFBSSxjQUFjLENBQUMsUUFBUSxFQUFFLEtBQUssRUFBRSxFQUFFO1lBQ3ZELE1BQU0sNEJBQTRCLENBQUM7U0FDcEM7UUFDRCxNQUFNLGVBQWUsR0FDbkIsY0FBYyxHQUFHLE9BQU8sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUM5RCxPQUFPLGVBQWUsQ0FBQztJQUN6QixDQUFDO0NBQ0Y7QUF4R0QsdUJBd0dDIn0=","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ChatMessageProto = exports.protobufPackage = void 0;\n/* eslint-disable */\nconst long_1 = __importDefault(require(\"long\"));\nconst minimal_1 = __importDefault(require(\"protobufjs/minimal\"));\nexports.protobufPackage = 'chat.v2';\nconst baseChatMessageProto = { timestamp: 0, nick: '' };\nexports.ChatMessageProto = {\n    encode(message, writer = minimal_1.default.Writer.create()) {\n        if (message.timestamp !== 0) {\n            writer.uint32(8).uint64(message.timestamp);\n        }\n        if (message.nick !== '') {\n            writer.uint32(18).string(message.nick);\n        }\n        if (message.payload.length !== 0) {\n            writer.uint32(26).bytes(message.payload);\n        }\n        return writer;\n    },\n    decode(input, length) {\n        const reader = input instanceof minimal_1.default.Reader ? input : new minimal_1.default.Reader(input);\n        let end = length === undefined ? reader.len : reader.pos + length;\n        const message = Object.assign({}, baseChatMessageProto);\n        message.payload = new Uint8Array();\n        while (reader.pos < end) {\n            const tag = reader.uint32();\n            switch (tag >>> 3) {\n                case 1:\n                    message.timestamp = longToNumber(reader.uint64());\n                    break;\n                case 2:\n                    message.nick = reader.string();\n                    break;\n                case 3:\n                    message.payload = reader.bytes();\n                    break;\n                default:\n                    reader.skipType(tag & 7);\n                    break;\n            }\n        }\n        return message;\n    },\n    fromJSON(object) {\n        const message = Object.assign({}, baseChatMessageProto);\n        message.payload = new Uint8Array();\n        if (object.timestamp !== undefined && object.timestamp !== null) {\n            message.timestamp = Number(object.timestamp);\n        }\n        else {\n            message.timestamp = 0;\n        }\n        if (object.nick !== undefined && object.nick !== null) {\n            message.nick = String(object.nick);\n        }\n        else {\n            message.nick = '';\n        }\n        if (object.payload !== undefined && object.payload !== null) {\n            message.payload = bytesFromBase64(object.payload);\n        }\n        return message;\n    },\n    toJSON(message) {\n        const obj = {};\n        message.timestamp !== undefined && (obj.timestamp = message.timestamp);\n        message.nick !== undefined && (obj.nick = message.nick);\n        message.payload !== undefined &&\n            (obj.payload = base64FromBytes(message.payload !== undefined ? message.payload : new Uint8Array()));\n        return obj;\n    },\n    fromPartial(object) {\n        const message = Object.assign({}, baseChatMessageProto);\n        if (object.timestamp !== undefined && object.timestamp !== null) {\n            message.timestamp = object.timestamp;\n        }\n        else {\n            message.timestamp = 0;\n        }\n        if (object.nick !== undefined && object.nick !== null) {\n            message.nick = object.nick;\n        }\n        else {\n            message.nick = '';\n        }\n        if (object.payload !== undefined && object.payload !== null) {\n            message.payload = object.payload;\n        }\n        else {\n            message.payload = new Uint8Array();\n        }\n        return message;\n    },\n};\nvar globalThis = (() => {\n    if (typeof globalThis !== 'undefined')\n        return globalThis;\n    if (typeof self !== 'undefined')\n        return self;\n    if (typeof window !== 'undefined')\n        return window;\n    if (typeof global !== 'undefined')\n        return global;\n    throw 'Unable to locate global object';\n})();\nconst atob = globalThis.atob ||\n    ((b64) => globalThis.Buffer.from(b64, 'base64').toString('binary'));\nfunction bytesFromBase64(b64) {\n    const bin = atob(b64);\n    const arr = new Uint8Array(bin.length);\n    for (let i = 0; i < bin.length; ++i) {\n        arr[i] = bin.charCodeAt(i);\n    }\n    return arr;\n}\nconst btoa = globalThis.btoa ||\n    ((bin) => globalThis.Buffer.from(bin, 'binary').toString('base64'));\nfunction base64FromBytes(arr) {\n    const bin = [];\n    for (let i = 0; i < arr.byteLength; ++i) {\n        bin.push(String.fromCharCode(arr[i]));\n    }\n    return btoa(bin.join(''));\n}\nfunction longToNumber(long) {\n    if (long.gt(Number.MAX_SAFE_INTEGER)) {\n        throw new globalThis.Error('Value is larger than Number.MAX_SAFE_INTEGER');\n    }\n    return long.toNumber();\n}\nif (minimal_1.default.util.Long !== long_1.default) {\n    minimal_1.default.util.Long = long_1.default;\n    minimal_1.default.configure();\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hhdF9tZXNzYWdlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL3Byb3RvL2NoYXQvdjIvY2hhdF9tZXNzYWdlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLG9CQUFvQjtBQUNwQixnREFBd0I7QUFDeEIsaUVBQXFDO0FBRXhCLFFBQUEsZUFBZSxHQUFHLFNBQVMsQ0FBQztBQVF6QyxNQUFNLG9CQUFvQixHQUFXLEVBQUUsU0FBUyxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLENBQUM7QUFFbkQsUUFBQSxnQkFBZ0IsR0FBRztJQUM5QixNQUFNLENBQ0osT0FBeUIsRUFDekIsU0FBcUIsaUJBQUcsQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFO1FBRXhDLElBQUksT0FBTyxDQUFDLFNBQVMsS0FBSyxDQUFDLEVBQUU7WUFDM0IsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1NBQzVDO1FBQ0QsSUFBSSxPQUFPLENBQUMsSUFBSSxLQUFLLEVBQUUsRUFBRTtZQUN2QixNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDeEM7UUFDRCxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtZQUNoQyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7U0FDMUM7UUFDRCxPQUFPLE1BQU0sQ0FBQztJQUNoQixDQUFDO0lBRUQsTUFBTSxDQUFDLEtBQThCLEVBQUUsTUFBZTtRQUNwRCxNQUFNLE1BQU0sR0FBRyxLQUFLLFlBQVksaUJBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFB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","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WakuStore = exports.StoreCodec = void 0;\nconst it_concat_1 = __importDefault(require(\"it-concat\"));\nconst it_length_prefixed_1 = __importDefault(require(\"it-length-prefixed\"));\nconst it_pipe_1 = __importDefault(require(\"it-pipe\"));\nconst waku_message_1 = require(\"../waku_message\");\nconst history_rpc_1 = require(\"./history_rpc\");\nexports.StoreCodec = '/vac/waku/store/2.0.0-beta1';\nclass WakuStore {\n    constructor(libp2p) {\n        this.libp2p = libp2p;\n    }\n    /**\n     * Retrieve history from given peer\n     * @param peerId\n     * @param topics\n     * @throws if not able to reach peer\n     */\n    async queryHistory(peerId, topics) {\n        var _a, _b, _c, _d;\n        const peer = this.libp2p.peerStore.get(peerId);\n        if (!peer)\n            throw 'Peer is unknown';\n        if (!peer.protocols.includes(exports.StoreCodec))\n            throw 'Peer does not register waku store protocol';\n        const connection = this.libp2p.connectionManager.get(peer.id);\n        if (!connection)\n            throw 'Failed to get a connection to the peer';\n        const messages = [];\n        let cursor = undefined;\n        while (true) {\n            try {\n                const { stream } = await connection.newStream(exports.StoreCodec);\n                try {\n                    const historyRpcQuery = history_rpc_1.HistoryRPC.createQuery(topics, cursor);\n                    const res = await it_pipe_1.default([historyRpcQuery.encode()], it_length_prefixed_1.default.encode(), stream, it_length_prefixed_1.default.decode(), it_concat_1.default);\n                    try {\n                        const reply = history_rpc_1.HistoryRPC.decode(res.slice());\n                        const response = reply.response;\n                        if (!response) {\n                            console.log('No response in HistoryRPC');\n                            return null;\n                        }\n                        if (!response.messages || !response.messages.length) {\n                            // No messages left (or stored)\n                            return messages;\n                        }\n                        response.messages.map((protoMsg) => {\n                            messages.push(waku_message_1.WakuMessage.fromProto(protoMsg));\n                        });\n                        const responsePageSize = (_a = response.pagingInfo) === null || _a === void 0 ? void 0 : _a.pageSize;\n                        const queryPageSize = (_c = (_b = historyRpcQuery.query) === null || _b === void 0 ? void 0 : _b.pagingInfo) === null || _c === void 0 ? void 0 : _c.pageSize;\n                        if (responsePageSize &&\n                            queryPageSize &&\n                            responsePageSize < queryPageSize) {\n                            // Response page size smaller than query, meaning this is the last page\n                            return messages;\n                        }\n                        cursor = (_d = response.pagingInfo) === null || _d === void 0 ? void 0 : _d.cursor;\n                        if (cursor === undefined) {\n                            // If the server does not return cursor then there is an issue,\n                            // Need to abort or we end up in an infinite loop\n                            console.log('No cursor returned by peer.');\n                            return messages;\n                        }\n                    }\n                    catch (err) {\n                        console.log('Failed to decode store reply', err);\n                    }\n                }\n                catch (err) {\n                    console.log('Failed to send waku store query', err);\n                }\n            }\n            catch (err) {\n                console.log('Failed to negotiate waku store protocol stream with peer', err);\n            }\n        }\n    }\n}\nexports.WakuStore = WakuStore;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvbGliL3dha3Vfc3RvcmUvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsMERBQStCO0FBQy9CLDRFQUFvQztBQUNwQyxzREFBMkI7QUFJM0Isa0RBQThDO0FBRTlDLCtDQUEyQztBQUU5QixRQUFBLFVBQVUsR0FBRyw2QkFBNkIsQ0FBQztBQUV4RCxNQUFhLFNBQVM7SUFDcEIsWUFBbUIsTUFBYztRQUFkLFdBQU0sR0FBTixNQUFNLENBQVE7SUFBRyxDQUFDO0lBRXJDOzs7OztPQUtHO0lBQ0gsS0FBSyxDQUFDLFlBQVksQ0FDaEIsTUFBYyxFQUNkLE1BQWlCOztRQUVqQixNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDL0MsSUFBSSxDQUFDLElBQUk7WUFBRSxNQUFNLGlCQUFpQixDQUFDO1FBQ25DLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxrQkFBVSxDQUFDO1lBQ3RDLE1BQU0sNENBQTRDLENBQUM7UUFDckQsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQzlELElBQUksQ0FBQyxVQUFVO1lBQUUsTUFBTSx3Q0FBd0MsQ0FBQztRQUVoRSxNQUFNLFFBQVEsR0FBa0IsRUFBRSxDQUFDO1FBQ25DLElBQUksTUFBTSxHQUFHLFNBQVMsQ0FBQztRQUN2QixPQUFPLElBQUksRUFBRTtZQUNYLElBQUk7Z0JBQ0YsTUFBTSxFQUFFLE1BQU0sRUFBRSxHQUFHLE1BQU0sVUFBVSxDQUFDLFNBQVMsQ0FBQyxrQkFBVSxDQUFDLENBQUM7Z0JBQzFELElBQUk7b0JBQ0YsTUFBTSxlQUFlLEdBQUcsd0JBQVUsQ0FBQyxXQUFXLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDO29CQUMvRCxNQUFNLEdBQUcsR0FBRyxNQUFNLGlCQUFJLENBQ3BCLENBQUMsZUFBZSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQzFCLDRCQUFFLENBQUMsTUFBTSxFQUFFLEVBQ1gsTUFBTSxFQUNOLDRCQUFFLENBQUMsTUFBTSxFQUFFLEVBQ1gsbUJBQU0sQ0FDUCxDQUFDO29CQUNGLElBQUk7d0JBQ0YsTUFBTSxLQUFLLEdBQUcsd0JBQVUsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUM7d0JBRTdDLE1BQU0sUUFBUSxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUM7d0JBQ2hDLElBQUksQ0FBQyxRQUFRLEVBQUU7NEJBQ2IsT0FBTyxDQUFDLEdBQUcsQ0FBQywyQkFBMkIsQ0FBQyxDQUFDOzRCQUN6QyxPQUFPLElBQUksQ0FBQzt5QkFDYjt3QkFFRCxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFOzRCQUNuRCwrQkFBK0I7NEJBQy9CLE9BQU8sUUFBUSxDQUFDO3lCQUNqQjt3QkFFRCxRQUFRLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLFFBQVEsRUFBRSxFQUFFOzRCQUNqQyxRQUFRLENBQUMsSUFBSSxDQUFDLDBCQUFXLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7d0JBQ2pELENBQUMsQ0FBQyxDQUFDO3dCQUVILE1BQU0sZ0JBQWdCLEdBQUcsTUFBQSxRQUFRLENBQUMsVUFBVSwwQ0FBRSxRQUFRLENBQUM7d0JBQ3ZELE1BQU0sYUFBYSxHQUFHLE1BQUEsTUFBQSxlQUFlLENBQUMsS0FBSywwQ0FBRSxVQUFVLDBDQUFFLFFBQVEsQ0FBQzt3QkFDbEUsSUFDRSxnQkFBZ0I7NEJBQ2hCLGFBQWE7NEJBQ2IsZ0JBQWdCLEdBQUcsYUFBYSxFQUNoQzs0QkFDQSx1RUFBdUU7NEJBQ3ZFLE9BQU8sUUFBUSxDQUFDO3lCQUNqQjt3QkFFRCxNQUFNLEdBQUcsTUFBQSxRQUFRLENBQUMsVUFBVSwwQ0FBRSxNQUFNLENBQUM7d0JBQ3JDLElBQUksTUFBTSxLQUFLLFNBQVMsRUFBRTs0QkFDeEIsK0RBQStEOzRCQUMvRCxpREFBaUQ7NEJBQ2pELE9BQU8sQ0FBQyxHQUFHLENBQUMsNkJBQTZCLENBQUMsQ0FBQzs0QkFDM0MsT0FBTyxRQUFRLENBQUM7eUJBQ2pCO3FCQUNGO29CQUFDLE9BQU8sR0FBRyxFQUFFO3dCQUNaLE9BQU8sQ0FBQyxHQUFHLENBQUMsOEJBQThCLEVBQUUsR0FBRyxDQUFDLENBQUM7cUJBQ2xEO2lCQUNGO2dCQUFDLE9BQU8sR0FBRyxFQUFFO29CQUNaLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUNBQWlDLEVBQUUsR0FBRyxDQUFDLENBQUM7aUJBQ3JEO2FBQ0Y7WUFBQyxPQUFPLEdBQUcsRUFBRTtnQkFDWixPQUFPLENBQUMsR0FBRyxDQUNULDBEQUEwRCxFQUMxRCxHQUFHLENBQ0osQ0FBQzthQUNIO1NBQ0Y7SUFDSCxDQUFDO0NBQ0Y7QUFwRkQsOEJBb0ZDIn0=","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.HistoryRPC = void 0;\nconst minimal_1 = require(\"protobufjs/minimal\");\nconst uuid_1 = require(\"uuid\");\nconst proto = __importStar(require(\"../../proto/waku/v2/store\"));\nconst waku_message_1 = require(\"../waku_message\");\nclass HistoryRPC {\n    constructor(proto) {\n        this.proto = proto;\n    }\n    static createQuery(contentTopics = [waku_message_1.DEFAULT_CONTENT_TOPIC], cursor) {\n        const pagingInfo = {\n            pageSize: 10,\n            cursor,\n            direction: proto.PagingInfo_Direction.DIRECTION_FORWARD,\n        };\n        const contentFilters = contentTopics.map((contentTopic) => {\n            return { contentTopic };\n        });\n        return new HistoryRPC({\n            requestId: uuid_1.v4(),\n            query: {\n                contentFilters,\n                pagingInfo,\n                startTime: undefined,\n                endTime: undefined,\n            },\n            response: undefined,\n        });\n    }\n    static decode(bytes) {\n        const res = proto.HistoryRPC.decode(minimal_1.Reader.create(bytes));\n        return new HistoryRPC(res);\n    }\n    encode() {\n        return proto.HistoryRPC.encode(this.proto).finish();\n    }\n    get query() {\n        return this.proto.query;\n    }\n    get response() {\n        return this.proto.response;\n    }\n}\nexports.HistoryRPC = HistoryRPC;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGlzdG9yeV9ycGMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvbGliL3dha3Vfc3RvcmUvaGlzdG9yeV9ycGMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLGdEQUE0QztBQUM1QywrQkFBa0M7QUFFbEMsaUVBQW1EO0FBQ25ELGtEQUF3RDtBQUV4RCxNQUFhLFVBQVU7SUFDckIsWUFBMEIsS0FBdUI7UUFBdkIsVUFBSyxHQUFMLEtBQUssQ0FBa0I7SUFBRyxDQUFDO0lBRXJELE1BQU0sQ0FBQyxXQUFXLENBQ2hCLGdCQUEwQixDQUFDLG9DQUFxQixDQUFDLEVBQ2pELE1BQW9CO1FBRXBCLE1BQU0sVUFBVSxHQUFHO1lBQ2pCLFFBQVEsRUFBRSxFQUFFO1lBQ1osTUFBTTtZQUNOLFNBQVMsRUFBRSxLQUFLLENBQUMsb0JBQW9CLENBQUMsaUJBQWlCO1NBQ3hELENBQUM7UUFFRixNQUFNLGNBQWMsR0FBRyxhQUFhLENBQUMsR0FBRyxDQUFDLENBQUMsWUFBWSxFQUFFLEVBQUU7WUFDeEQsT0FBTyxFQUFFLFlBQVksRUFBRSxDQUFDO1FBQzFCLENBQUMsQ0FBQyxDQUFDO1FBRUgsT0FBTyxJQUFJLFVBQVUsQ0FBQztZQUNwQixTQUFTLEVBQUUsU0FBSSxFQUFFO1lBQ2pCLEtBQUssRUFBRTtnQkFDTCxjQUFjO2dCQUNkLFVBQVU7Z0JBQ1YsU0FBUyxFQUFFLFNBQVM7Z0JBQ3BCLE9BQU8sRUFBRSxTQUFTO2FBQ25CO1lBQ0QsUUFBUSxFQUFFLFNBQVM7U0FDcEIsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBaUI7UUFDN0IsTUFBTSxHQUFHLEdBQUcsS0FBSyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsZ0JBQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUMxRCxPQUFPLElBQUksVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQzdCLENBQUM7SUFFRCxNQUFNO1FBQ0osT0FBTyxLQUFLLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUM7SUFDdEQsQ0FBQztJQUVELElBQUksS0FBSztRQUNQLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUM7SUFDMUIsQ0FBQztJQUVELElBQUksUUFBUTtRQUNWLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUM7SUFDN0IsQ0FBQztDQUNGO0FBN0NELGdDQTZDQyJ9","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.HistoryRPC = exports.HistoryResponse = exports.HistoryQuery = exports.ContentFilter = exports.PagingInfo = exports.Index = exports.pagingInfo_DirectionToJSON = exports.pagingInfo_DirectionFromJSON = exports.PagingInfo_Direction = exports.protobufPackage = void 0;\n/* eslint-disable */\nconst long_1 = __importDefault(require(\"long\"));\nconst minimal_1 = __importDefault(require(\"protobufjs/minimal\"));\nconst message_1 = require(\"../../waku/v2/message\");\nexports.protobufPackage = 'waku.v2';\nvar PagingInfo_Direction;\n(function (PagingInfo_Direction) {\n    PagingInfo_Direction[PagingInfo_Direction[\"DIRECTION_BACKWARD_UNSPECIFIED\"] = 0] = \"DIRECTION_BACKWARD_UNSPECIFIED\";\n    PagingInfo_Direction[PagingInfo_Direction[\"DIRECTION_FORWARD\"] = 1] = \"DIRECTION_FORWARD\";\n    PagingInfo_Direction[PagingInfo_Direction[\"UNRECOGNIZED\"] = -1] = \"UNRECOGNIZED\";\n})(PagingInfo_Direction = exports.PagingInfo_Direction || (exports.PagingInfo_Direction = {}));\nfunction pagingInfo_DirectionFromJSON(object) {\n    switch (object) {\n        case 0:\n        case 'DIRECTION_BACKWARD_UNSPECIFIED':\n            return PagingInfo_Direction.DIRECTION_BACKWARD_UNSPECIFIED;\n        case 1:\n        case 'DIRECTION_FORWARD':\n            return PagingInfo_Direction.DIRECTION_FORWARD;\n        case -1:\n        case 'UNRECOGNIZED':\n        default:\n            return PagingInfo_Direction.UNRECOGNIZED;\n    }\n}\nexports.pagingInfo_DirectionFromJSON = pagingInfo_DirectionFromJSON;\nfunction pagingInfo_DirectionToJSON(object) {\n    switch (object) {\n        case PagingInfo_Direction.DIRECTION_BACKWARD_UNSPECIFIED:\n            return 'DIRECTION_BACKWARD_UNSPECIFIED';\n        case PagingInfo_Direction.DIRECTION_FORWARD:\n            return 'DIRECTION_FORWARD';\n        default:\n            return 'UNKNOWN';\n    }\n}\nexports.pagingInfo_DirectionToJSON = pagingInfo_DirectionToJSON;\nconst baseIndex = { receivedTime: 0 };\nexports.Index = {\n    encode(message, writer = minimal_1.default.Writer.create()) {\n        if (message.digest.length !== 0) {\n            writer.uint32(10).bytes(message.digest);\n        }\n        if (message.receivedTime !== 0) {\n            writer.uint32(17).double(message.receivedTime);\n        }\n        return writer;\n    },\n    decode(input, length) {\n        const reader = input instanceof minimal_1.default.Reader ? input : new minimal_1.default.Reader(input);\n        let end = length === undefined ? reader.len : reader.pos + length;\n        const message = Object.assign({}, baseIndex);\n        message.digest = new Uint8Array();\n        while (reader.pos < end) {\n            const tag = reader.uint32();\n            switch (tag >>> 3) {\n                case 1:\n                    message.digest = reader.bytes();\n                    break;\n                case 2:\n                    message.receivedTime = reader.double();\n                    break;\n                default:\n                    reader.skipType(tag & 7);\n                    break;\n            }\n        }\n        return message;\n    },\n    fromJSON(object) {\n        const message = Object.assign({}, baseIndex);\n        message.digest = new Uint8Array();\n        if (object.digest !== undefined && object.digest !== null) {\n            message.digest = bytesFromBase64(object.digest);\n        }\n        if (object.receivedTime !== undefined && object.receivedTime !== null) {\n            message.receivedTime = Number(object.receivedTime);\n        }\n        else {\n            message.receivedTime = 0;\n        }\n        return message;\n    },\n    toJSON(message) {\n        const obj = {};\n        message.digest !== undefined &&\n            (obj.digest = base64FromBytes(message.digest !== undefined ? message.digest : new Uint8Array()));\n        message.receivedTime !== undefined &&\n            (obj.receivedTime = message.receivedTime);\n        return obj;\n    },\n    fromPartial(object) {\n        const message = Object.assign({}, baseIndex);\n        if (object.digest !== undefined && object.digest !== null) {\n            message.digest = object.digest;\n        }\n        else {\n            message.digest = new Uint8Array();\n        }\n        if (object.receivedTime !== undefined && object.receivedTime !== null) {\n            message.receivedTime = object.receivedTime;\n        }\n        else {\n            message.receivedTime = 0;\n        }\n        return message;\n    },\n};\nconst basePagingInfo = { pageSize: 0, direction: 0 };\nexports.PagingInfo = {\n    encode(message, writer = minimal_1.default.Writer.create()) {\n        if (message.pageSize !== 0) {\n            writer.uint32(8).uint64(message.pageSize);\n        }\n        if (message.cursor !== undefined) {\n            exports.Index.encode(message.cursor, writer.uint32(18).fork()).ldelim();\n        }\n        if (message.direction !== 0) {\n            writer.uint32(24).int32(message.direction);\n        }\n        return writer;\n    },\n    decode(input, length) {\n        const reader = input instanceof minimal_1.default.Reader ? input : new minimal_1.default.Reader(input);\n        let end = length === undefined ? reader.len : reader.pos + length;\n        const message = Object.assign({}, basePagingInfo);\n        while (reader.pos < end) {\n            const tag = reader.uint32();\n            switch (tag >>> 3) {\n                case 1:\n                    message.pageSize = longToNumber(reader.uint64());\n                    break;\n                case 2:\n                    message.cursor = exports.Index.decode(reader, reader.uint32());\n                    break;\n                case 3:\n                    message.direction = reader.int32();\n                    break;\n                default:\n                    reader.skipType(tag & 7);\n                    break;\n            }\n        }\n        return message;\n    },\n    fromJSON(object) {\n        const message = Object.assign({}, basePagingInfo);\n        if (object.pageSize !== undefined && object.pageSize !== null) {\n            message.pageSize = Number(object.pageSize);\n        }\n        else {\n            message.pageSize = 0;\n        }\n        if (object.cursor !== undefined && object.cursor !== null) {\n            message.cursor = exports.Index.fromJSON(object.cursor);\n        }\n        else {\n            message.cursor = undefined;\n        }\n        if (object.direction !== undefined && object.direction !== null) {\n            message.direction = pagingInfo_DirectionFromJSON(object.direction);\n        }\n        else {\n            message.direction = 0;\n        }\n        return message;\n    },\n    toJSON(message) {\n        const obj = {};\n        message.pageSize !== undefined && (obj.pageSize = message.pageSize);\n        message.cursor !== undefined &&\n            (obj.cursor = message.cursor ? exports.Index.toJSON(message.cursor) : undefined);\n        message.direction !== undefined &&\n            (obj.direction = pagingInfo_DirectionToJSON(message.direction));\n        return obj;\n    },\n    fromPartial(object) {\n        const message = Object.assign({}, basePagingInfo);\n        if (object.pageSize !== undefined && object.pageSize !== null) {\n            message.pageSize = object.pageSize;\n        }\n        else {\n            message.pageSize = 0;\n        }\n        if (object.cursor !== undefined && object.cursor !== null) {\n            message.cursor = exports.Index.fromPartial(object.cursor);\n        }\n        else {\n            message.cursor = undefined;\n        }\n        if (object.direction !== undefined && object.direction !== null) {\n            message.direction = object.direction;\n        }\n        else {\n            message.direction = 0;\n        }\n        return message;\n    },\n};\nconst baseContentFilter = { contentTopic: '' };\nexports.ContentFilter = {\n    encode(message, writer = minimal_1.default.Writer.create()) {\n        if (message.contentTopic !== '') {\n            writer.uint32(10).string(message.contentTopic);\n        }\n        return writer;\n    },\n    decode(input, length) {\n        const reader = input instanceof minimal_1.default.Reader ? input : new minimal_1.default.Reader(input);\n        let end = length === undefined ? reader.len : reader.pos + length;\n        const message = Object.assign({}, baseContentFilter);\n        while (reader.pos < end) {\n            const tag = reader.uint32();\n            switch (tag >>> 3) {\n                case 1:\n                    message.contentTopic = reader.string();\n                    break;\n                default:\n                    reader.skipType(tag & 7);\n                    break;\n            }\n        }\n        return message;\n    },\n    fromJSON(object) {\n        const message = Object.assign({}, baseContentFilter);\n        if (object.contentTopic !== undefined && object.contentTopic !== null) {\n            message.contentTopic = String(object.contentTopic);\n        }\n        else {\n            message.contentTopic = '';\n        }\n        return message;\n    },\n    toJSON(message) {\n        const obj = {};\n        message.contentTopic !== undefined &&\n            (obj.contentTopic = message.contentTopic);\n        return obj;\n    },\n    fromPartial(object) {\n        const message = Object.assign({}, baseContentFilter);\n        if (object.contentTopic !== undefined && object.contentTopic !== null) {\n            message.contentTopic = object.contentTopic;\n        }\n        else {\n            message.contentTopic = '';\n        }\n        return message;\n    },\n};\nconst baseHistoryQuery = {};\nexports.HistoryQuery = {\n    encode(message, writer = minimal_1.default.Writer.create()) {\n        for (const v of message.contentFilters) {\n            exports.ContentFilter.encode(v, writer.uint32(18).fork()).ldelim();\n        }\n        if (message.pagingInfo !== undefined) {\n            exports.PagingInfo.encode(message.pagingInfo, writer.uint32(26).fork()).ldelim();\n        }\n        if (message.startTime !== undefined) {\n            writer.uint32(33).double(message.startTime);\n        }\n        if (message.endTime !== undefined) {\n            writer.uint32(41).double(message.endTime);\n        }\n        return writer;\n    },\n    decode(input, length) {\n        const reader = input instanceof minimal_1.default.Reader ? input : new minimal_1.default.Reader(input);\n        let end = length === undefined ? reader.len : reader.pos + length;\n        const message = Object.assign({}, baseHistoryQuery);\n        message.contentFilters = [];\n        while (reader.pos < end) {\n            const tag = reader.uint32();\n            switch (tag >>> 3) {\n                case 2:\n                    message.contentFilters.push(exports.ContentFilter.decode(reader, reader.uint32()));\n                    break;\n                case 3:\n                    message.pagingInfo = exports.PagingInfo.decode(reader, reader.uint32());\n                    break;\n                case 4:\n                    message.startTime = reader.double();\n                    break;\n                case 5:\n                    message.endTime = reader.double();\n                    break;\n                default:\n                    reader.skipType(tag & 7);\n                    break;\n            }\n        }\n        return message;\n    },\n    fromJSON(object) {\n        const message = Object.assign({}, baseHistoryQuery);\n        message.contentFilters = [];\n        if (object.contentFilters !== undefined && object.contentFilters !== null) {\n            for (const e of object.contentFilters) {\n                message.contentFilters.push(exports.ContentFilter.fromJSON(e));\n            }\n        }\n        if (object.pagingInfo !== undefined && object.pagingInfo !== null) {\n            message.pagingInfo = exports.PagingInfo.fromJSON(object.pagingInfo);\n        }\n        else {\n            message.pagingInfo = undefined;\n        }\n        if (object.startTime !== undefined && object.startTime !== null) {\n            message.startTime = Number(object.startTime);\n        }\n        else {\n            message.startTime = undefined;\n        }\n        if (object.endTime !== undefined && object.endTime !== null) {\n            message.endTime = Number(object.endTime);\n        }\n        else {\n            message.endTime = undefined;\n        }\n        return message;\n    },\n    toJSON(message) {\n        const obj = {};\n        if (message.contentFilters) {\n            obj.contentFilters = message.contentFilters.map((e) => e ? exports.ContentFilter.toJSON(e) : undefined);\n        }\n        else {\n            obj.contentFilters = [];\n        }\n        message.pagingInfo !== undefined &&\n            (obj.pagingInfo = message.pagingInfo\n                ? exports.PagingInfo.toJSON(message.pagingInfo)\n                : undefined);\n        message.startTime !== undefined && (obj.startTime = message.startTime);\n        message.endTime !== undefined && (obj.endTime = message.endTime);\n        return obj;\n    },\n    fromPartial(object) {\n        const message = Object.assign({}, baseHistoryQuery);\n        message.contentFilters = [];\n        if (object.contentFilters !== undefined && object.contentFilters !== null) {\n            for (const e of object.contentFilters) {\n                message.contentFilters.push(exports.ContentFilter.fromPartial(e));\n            }\n        }\n        if (object.pagingInfo !== undefined && object.pagingInfo !== null) {\n            message.pagingInfo = exports.PagingInfo.fromPartial(object.pagingInfo);\n        }\n        else {\n            message.pagingInfo = undefined;\n        }\n        if (object.startTime !== undefined && object.startTime !== null) {\n            message.startTime = object.startTime;\n        }\n        else {\n            message.startTime = undefined;\n        }\n        if (object.endTime !== undefined && object.endTime !== null) {\n            message.endTime = object.endTime;\n        }\n        else {\n            message.endTime = undefined;\n        }\n        return message;\n    },\n};\nconst baseHistoryResponse = {};\nexports.HistoryResponse = {\n    encode(message, writer = minimal_1.default.Writer.create()) {\n        for (const v of message.messages) {\n            message_1.WakuMessageProto.encode(v, writer.uint32(10).fork()).ldelim();\n        }\n        if (message.pagingInfo !== undefined) {\n            exports.PagingInfo.encode(message.pagingInfo, writer.uint32(18).fork()).ldelim();\n        }\n        return writer;\n    },\n    decode(input, length) {\n        const reader = input instanceof minimal_1.default.Reader ? input : new minimal_1.default.Reader(input);\n        let end = length === undefined ? reader.len : reader.pos + length;\n        const message = Object.assign({}, baseHistoryResponse);\n        message.messages = [];\n        while (reader.pos < end) {\n            const tag = reader.uint32();\n            switch (tag >>> 3) {\n                case 1:\n                    message.messages.push(message_1.WakuMessageProto.decode(reader, reader.uint32()));\n                    break;\n                case 2:\n                    message.pagingInfo = exports.PagingInfo.decode(reader, reader.uint32());\n                    break;\n                default:\n                    reader.skipType(tag & 7);\n                    break;\n            }\n        }\n        return message;\n    },\n    fromJSON(object) {\n        const message = Object.assign({}, baseHistoryResponse);\n        message.messages = [];\n        if (object.messages !== undefined && object.messages !== null) {\n            for (const e of object.messages) {\n                message.messages.push(message_1.WakuMessageProto.fromJSON(e));\n            }\n        }\n        if (object.pagingInfo !== undefined && object.pagingInfo !== null) {\n            message.pagingInfo = exports.PagingInfo.fromJSON(object.pagingInfo);\n        }\n        else {\n            message.pagingInfo = undefined;\n        }\n        return message;\n    },\n    toJSON(message) {\n        const obj = {};\n        if (message.messages) {\n            obj.messages = message.messages.map((e) => e ? message_1.WakuMessageProto.toJSON(e) : undefined);\n        }\n        else {\n            obj.messages = [];\n        }\n        message.pagingInfo !== undefined &&\n            (obj.pagingInfo = message.pagingInfo\n                ? exports.PagingInfo.toJSON(message.pagingInfo)\n                : undefined);\n        return obj;\n    },\n    fromPartial(object) {\n        const message = Object.assign({}, baseHistoryResponse);\n        message.messages = [];\n        if (object.messages !== undefined && object.messages !== null) {\n            for (const e of object.messages) {\n                message.messages.push(message_1.WakuMessageProto.fromPartial(e));\n            }\n        }\n        if (object.pagingInfo !== undefined && object.pagingInfo !== null) {\n            message.pagingInfo = exports.PagingInfo.fromPartial(object.pagingInfo);\n        }\n        else {\n            message.pagingInfo = undefined;\n        }\n        return message;\n    },\n};\nconst baseHistoryRPC = { requestId: '' };\nexports.HistoryRPC = {\n    encode(message, writer = minimal_1.default.Writer.create()) {\n        if (message.requestId !== '') {\n            writer.uint32(10).string(message.requestId);\n        }\n        if (message.query !== undefined) {\n            exports.HistoryQuery.encode(message.query, writer.uint32(18).fork()).ldelim();\n        }\n        if (message.response !== undefined) {\n            exports.HistoryResponse.encode(message.response, writer.uint32(26).fork()).ldelim();\n        }\n        return writer;\n    },\n    decode(input, length) {\n        const reader = input instanceof minimal_1.default.Reader ? input : new minimal_1.default.Reader(input);\n        let end = length === undefined ? reader.len : reader.pos + length;\n        const message = Object.assign({}, baseHistoryRPC);\n        while (reader.pos < end) {\n            const tag = reader.uint32();\n            switch (tag >>> 3) {\n                case 1:\n                    message.requestId = reader.string();\n                    break;\n                case 2:\n                    message.query = exports.HistoryQuery.decode(reader, reader.uint32());\n                    break;\n                case 3:\n                    message.response = exports.HistoryResponse.decode(reader, reader.uint32());\n                    break;\n                default:\n                    reader.skipType(tag & 7);\n                    break;\n            }\n        }\n        return message;\n    },\n    fromJSON(object) {\n        const message = Object.assign({}, baseHistoryRPC);\n        if (object.requestId !== undefined && object.requestId !== null) {\n            message.requestId = String(object.requestId);\n        }\n        else {\n            message.requestId = '';\n        }\n        if (object.query !== undefined && object.query !== null) {\n            message.query = exports.HistoryQuery.fromJSON(object.query);\n        }\n        else {\n            message.query = undefined;\n        }\n        if (object.response !== undefined && object.response !== null) {\n            message.response = exports.HistoryResponse.fromJSON(object.response);\n        }\n        else {\n            message.response = undefined;\n        }\n        return message;\n    },\n    toJSON(message) {\n        const obj = {};\n        message.requestId !== undefined && (obj.requestId = message.requestId);\n        message.query !== undefined &&\n            (obj.query = message.query\n                ? exports.HistoryQuery.toJSON(message.query)\n                : undefined);\n        message.response !== undefined &&\n            (obj.response = message.response\n                ? exports.HistoryResponse.toJSON(message.response)\n                : undefined);\n        return obj;\n    },\n    fromPartial(object) {\n        const message = Object.assign({}, baseHistoryRPC);\n        if (object.requestId !== undefined && object.requestId !== null) {\n            message.requestId = object.requestId;\n        }\n        else {\n            message.requestId = '';\n        }\n        if (object.query !== undefined && object.query !== null) {\n            message.query = exports.HistoryQuery.fromPartial(object.query);\n        }\n        else {\n            message.query = undefined;\n        }\n        if (object.response !== undefined && object.response !== null) {\n            message.response = exports.HistoryResponse.fromPartial(object.response);\n        }\n        else {\n            message.response = undefined;\n        }\n        return message;\n    },\n};\nvar globalThis = (() => {\n    if (typeof globalThis !== 'undefined')\n        return globalThis;\n    if (typeof self !== 'undefined')\n        return self;\n    if (typeof window !== 'undefined')\n        return window;\n    if (typeof global !== 'undefined')\n        return global;\n    throw 'Unable to locate global object';\n})();\nconst atob = globalThis.atob ||\n    ((b64) => globalThis.Buffer.from(b64, 'base64').toString('binary'));\nfunction bytesFromBase64(b64) {\n    const bin = atob(b64);\n    const arr = new Uint8Array(bin.length);\n    for (let i = 0; i < bin.length; ++i) {\n        arr[i] = bin.charCodeAt(i);\n    }\n    return arr;\n}\nconst btoa = globalThis.btoa ||\n    ((bin) => globalThis.Buffer.from(bin, 'binary').toString('base64'));\nfunction base64FromBytes(arr) {\n    const bin = [];\n    for (let i = 0; i < arr.byteLength; ++i) {\n        bin.push(String.fromCharCode(arr[i]));\n    }\n    return btoa(bin.join(''));\n}\nfunction longToNumber(long) {\n    if (long.gt(Number.MAX_SAFE_INTEGER)) {\n        throw new globalThis.Error('Value is larger than Number.MAX_SAFE_INTEGER');\n    }\n    return long.toNumber();\n}\nif (minimal_1.default.util.Long !== long_1.default) {\n    minimal_1.default.util.Long = long_1.default;\n    minimal_1.default.configure();\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RvcmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvcHJvdG8vd2FrdS92Mi9zdG9yZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxvQkFBb0I7QUFDcEIsZ0RBQXdCO0FBQ3hCLGlFQUFxQztBQUNyQyxtREFBeUQ7QUFFNUMsUUFBQSxlQUFlLEdBQUcsU0FBUyxDQUFDO0FBYXpDLElBQVksb0JBSVg7QUFKRCxXQUFZLG9CQUFvQjtJQUM5QixtSEFBa0MsQ0FBQTtJQUNsQyx5RkFBcUIsQ0FBQTtJQUNyQixnRkFBaUIsQ0FBQTtBQUNuQixDQUFDLEVBSlcsb0JBQW9CLEdBQXBCLDRCQUFvQixLQUFwQiw0QkFBb0IsUUFJL0I7QUFFRCxTQUFnQiw0QkFBNEIsQ0FDMUMsTUFBVztJQUVYLFFBQVEsTUFBTSxFQUFFO1FBQ2QsS0FBSyxDQUFDLENBQUM7UUFDUCxLQUFLLGdDQUFnQztZQUNuQyxPQUFPLG9CQUFvQixDQUFDLDhCQUE4QixDQUFDO1FBQzdELEtBQUssQ0FBQyxDQUFDO1FBQ1AsS0FBSyxtQkFBbUI7WUFDdEIsT0FBTyxvQkFBb0IsQ0FBQyxpQkFBaUIsQ0FBQztRQUNoRCxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQ1IsS0FBSyxjQUFjLENBQUM7UUFDcEI7WUFDRSxPQUFPLG9CQUFvQixDQUFDLFlBQVksQ0FBQztLQUM1QztBQUNILENBQUM7QUFmRCxvRUFlQztBQUVELFNBQWdCLDBCQUEwQixDQUN4QyxNQUE0QjtJQUU1QixRQUFRLE1BQU0sRUFBRTtRQUNkLEtBQUssb0JBQW9CLENBQUMsOEJBQThCO1lBQ3RELE9BQU8sZ0NBQWdDLENBQUM7UUFDMUMsS0FBSyxvQkFBb0IsQ0FBQyxpQkFBaUI7WUFDekMsT0FBTyxtQkFBbUIsQ0FBQztRQUM3QjtZQUNFLE9BQU8sU0FBUyxDQUFDO0tBQ3BCO0FBQ0gsQ0FBQztBQVhELGdFQVdDO0FBd0JELE1BQU0sU0FBUyxHQUFXLEVBQUUsWUFB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","import { multiaddr } from 'multiaddr';\nimport PeerId from 'peer-id';\nimport Waku from '../../build/main/lib/waku';\n\nfunction help(): string[] {\n  return [\n    '/nick <nickname>: set a new nickname',\n    '/info: some information about the node',\n    '/connect <Multiaddr>: connect to the given peer',\n    '/help: Display this help',\n  ];\n}\n\nfunction nick(\n  nick: string | undefined,\n  setNick: (nick: string) => void\n): string[] {\n  if (!nick) {\n    return ['No nick provided'];\n  }\n  setNick(nick);\n  return [`New nick: ${nick}`];\n}\n\nfunction info(waku: Waku | undefined): string[] {\n  if (!waku) {\n    return ['Waku node is starting'];\n  }\n  return [`PeerId: ${waku.libp2p.peerId.toB58String()}`];\n}\n\nfunction connect(peer: string | undefined, waku: Waku | undefined): string[] {\n  if (!waku) {\n    return ['Waku node is starting'];\n  }\n  if (!peer) {\n    return ['No peer provided'];\n  }\n  try {\n    const peerMultiaddr = multiaddr(peer);\n    const peerId = peerMultiaddr.getPeerId();\n    if (!peerId) {\n      return ['Peer Id needed to dial'];\n    }\n    waku.libp2p.peerStore.addressBook.add(PeerId.createFromB58String(peerId), [\n      peerMultiaddr,\n    ]);\n    return [\n      `${peerId}: ${peerMultiaddr.toString()} added to address book, autodial in progress`,\n    ];\n  } catch (e) {\n    return ['Invalid multiaddr: ' + e];\n  }\n}\n\nfunction peers(waku: Waku | undefined): string[] {\n  if (!waku) {\n    return ['Waku node is starting'];\n  }\n  let response: string[] = [];\n  waku.libp2p.peerStore.peers.forEach((peer, peerId) => {\n    response.push(peerId + ':');\n    let addresses = '  addresses: [';\n    peer.addresses.forEach(({ multiaddr }) => {\n      addresses += ' ' + multiaddr.toString() + ',';\n    });\n    addresses = addresses.replace(/,$/, '');\n    addresses += ']';\n    response.push(addresses);\n    let protocols = '  protocols: [';\n    protocols += peer.protocols;\n    protocols += ']';\n    response.push(protocols);\n  });\n  if (response.length === 0) {\n    response.push('Not connected to any peer.');\n  }\n  return response;\n}\n\nexport default function handleCommand(\n  input: string,\n  waku: Waku | undefined,\n  setNick: (nick: string) => void\n): { command: string; response: string[] } {\n  let response: string[] = [];\n  const args = parseInput(input);\n  const command = args.shift()!;\n  switch (command) {\n    case '/help':\n      help().map((str) => response.push(str));\n      break;\n    case '/nick':\n      nick(args.shift(), setNick).map((str) => response.push(str));\n      break;\n    case '/info':\n      info(waku).map((str) => response.push(str));\n      break;\n    case '/connect':\n      connect(args.shift(), waku).map((str) => response.push(str));\n      break;\n    case '/peers':\n      peers(waku).map((str) => response.push(str));\n      break;\n    default:\n      response.push(`Unknown Command '${command}'`);\n  }\n  return { command, response };\n}\n\nexport function parseInput(input: string): string[] {\n  const clean = input.trim().replaceAll(/\\s\\s+/g, ' ');\n  return clean.split(' ');\n}\n","import {\n  Card,\n  CardContent,\n  List,\n  ListItem,\n  ListItemText,\n  Typography,\n} from '@material-ui/core';\nimport React, { useEffect, useRef } from 'react';\nimport { ChatMessage } from '../../build/main/chat/chat_message';\n\ninterface Props {\n  messages: ChatMessage[];\n}\n\nexport default function ChatList(props: Props) {\n  const messages = props.messages;\n\n  const listItems = messages.map((message) => (\n    <ListItem key={message.timestamp.toString()}>\n      <ListItemText primary={<Message message={message} />} />\n    </ListItem>\n  ));\n\n  return (\n    <List dense={true}>\n      {listItems}\n      <AlwaysScrollToBottom messages={messages} />\n    </List>\n  );\n}\n\ninterface MessageProps {\n  message: ChatMessage;\n}\n\nfunction Message(props: MessageProps) {\n  const chatMsg = props.message;\n  const timestamp = chatMsg.timestamp.toLocaleString([], {\n    month: 'short',\n    day: 'numeric',\n    hour: 'numeric',\n    minute: '2-digit',\n    hour12: false,\n  });\n\n  // {`<${timestamp}> ${chatMsg.nick}: ${chatMsg.message}`}\n  return (\n    <Card className=\"chat-message\" variant=\"outlined\">\n      <CardContent>\n        <Typography className=\"chat-nick\" variant=\"subtitle2\">\n          {chatMsg.nick}\n          <Typography\n            className=\"chat-timestamp\"\n            color=\"textSecondary\"\n            variant=\"caption\"\n            style={{ marginLeft: 3 }}\n          >\n            {timestamp}\n          </Typography>\n        </Typography>\n        <Typography\n          className=\"chat-message-content\"\n          variant=\"body1\"\n          component=\"p\"\n        >\n          {chatMsg.message}\n        </Typography>\n      </CardContent>\n    </Card>\n  );\n}\n\nconst AlwaysScrollToBottom = (props: Props) => {\n  const elementRef = useRef<HTMLDivElement>();\n\n  useEffect(() => {\n    // @ts-ignore\n    elementRef.current.scrollIntoView();\n  }, [props.messages]);\n\n  // @ts-ignore\n  return <div ref={elementRef} />;\n};\n","import { createContext, useContext } from 'react';\nimport Waku from 'waku/waku';\n\nexport type WakuContextType = {\n  waku?: Waku;\n};\n\nexport const WakuContext = createContext<WakuContextType>({ waku: undefined });\nexport const useWaku = () => useContext(WakuContext);\n","import React, { ChangeEvent, KeyboardEvent, useState } from 'react';\nimport { Button, Grid, TextField } from '@material-ui/core';\nimport { useWaku } from './WakuContext';\n\ninterface Props {\n  messageHandler: (msg: string) => void;\n  sendMessage: (() => Promise<void>) | undefined;\n}\n\nexport default function MessageInput(props: Props) {\n  const [inputText, setInputText] = useState<string>('');\n  const { waku } = useWaku();\n\n  const sendMessage = async () => {\n    if (props.sendMessage) {\n      await props.sendMessage();\n      setInputText('');\n    }\n  };\n\n  const messageHandler = (event: ChangeEvent<HTMLInputElement>) => {\n    setInputText(event.target.value);\n    props.messageHandler(event.target.value);\n  };\n\n  const keyPressHandler = async (event: KeyboardEvent<HTMLInputElement>) => {\n    if (event.key === 'Enter') {\n      await sendMessage();\n    }\n  };\n\n  return (\n    <Grid container direction=\"row\" alignItems=\"center\">\n      <Grid item xs={11}>\n        <TextField\n          variant=\"outlined\"\n          label=\"Send a message\"\n          value={inputText}\n          fullWidth={true}\n          InputLabelProps={{\n            shrink: true,\n          }}\n          onChange={messageHandler}\n          onKeyPress={keyPressHandler}\n          disabled={!waku}\n        />\n      </Grid>\n      <Grid item xs={1}>\n        <Button\n          variant=\"contained\"\n          color=\"primary\"\n          size=\"large\"\n          onClick={sendMessage}\n          disabled={!waku}\n        >\n          Send\n        </Button>\n      </Grid>\n    </Grid>\n  );\n}\n","import React, { useState } from 'react';\nimport { ChatMessage } from 'waku-chat/chat_message';\nimport { WakuMessage } from 'waku/waku_message';\nimport { ChatContentTopic } from './App';\nimport ChatList from './ChatList';\nimport MessageInput from './MessageInput';\nimport { useWaku } from './WakuContext';\n\ninterface Props {\n  lines: ChatMessage[];\n  commandHandler: (cmd: string) => void;\n  nick: string;\n}\n\nexport default function Room(props: Props) {\n  let [messageToSend, setMessageToSend] = useState<string>('');\n  const { waku } = useWaku();\n\n  return (\n    <div\n      className=\"chat-container\"\n      style={{ height: '98vh', display: 'flex', flexDirection: 'column' }}\n    >\n      <div\n        className=\"chat-list\"\n        style={{ display: 'flex', flexGrow: 1, overflowY: 'scroll' }}\n      >\n        <ChatList messages={props.lines} />\n      </div>\n      <div className=\"chat-input\" style={{ display: 'flex', padding: 20 }}>\n        <MessageInput\n          messageHandler={setMessageToSend}\n          sendMessage={\n            waku\n              ? async () => {\n                  return handleMessage(\n                    messageToSend,\n                    props.nick,\n                    props.commandHandler,\n                    waku.relay.send.bind(waku.relay)\n                  );\n                }\n              : undefined\n          }\n        />\n      </div>\n    </div>\n  );\n}\n\nasync function handleMessage(\n  message: string,\n  nick: string,\n  commandHandler: (cmd: string) => void,\n  messageSender: (msg: WakuMessage) => Promise<void>\n) {\n  if (message.startsWith('/')) {\n    commandHandler(message);\n  } else {\n    const chatMessage = new ChatMessage(new Date(), nick, message);\n    const wakuMsg = WakuMessage.fromBytes(\n      chatMessage.encode(),\n      ChatContentTopic\n    );\n    return messageSender(wakuMsg);\n  }\n}\n","import { multiaddr } from 'multiaddr';\nimport PeerId from 'peer-id';\nimport React, { useEffect, useState } from 'react';\nimport './App.css';\nimport { ChatMessage } from 'waku-chat/chat_message';\nimport { WakuMessage } from 'waku/waku_message';\nimport { RelayDefaultTopic } from 'waku/waku_relay';\nimport handleCommand from './command';\nimport Room from './Room';\nimport Waku from 'waku/waku';\nimport { WakuContext } from './WakuContext';\n\nexport const ChatContentTopic = 'dingpu';\n\nexport default function App() {\n  let [stateMessages, setMessages] = useState<ChatMessage[]>([]);\n  let [stateWaku, setWaku] = useState<Waku | undefined>(undefined);\n  let [nick, setNick] = useState<string>('web-chat');\n\n  useEffect(() => {\n    const handleNewMessages = (event: { data: Uint8Array }) => {\n      const chatMsg = decodeWakuMessage(event.data);\n      if (chatMsg) {\n        copyAndReplace([chatMsg], stateMessages, setMessages);\n      }\n    };\n\n    if (!stateWaku) {\n      initWaku(setWaku)\n        .then(() => console.log('Waku init done'))\n        .catch((e) => console.log('Waku init failed ', e));\n    } else {\n      stateWaku.libp2p.pubsub.on(RelayDefaultTopic, handleNewMessages);\n\n      // To clean up listener when component unmounts\n      return () => {\n        stateWaku?.libp2p.pubsub.removeListener(\n          RelayDefaultTopic,\n          handleNewMessages\n        );\n      };\n    }\n  }, [stateWaku, stateMessages]);\n\n  return (\n    <div\n      className=\"chat-app\"\n      style={{ height: '100vh', width: '100vw', overflow: 'hidden' }}\n    >\n      <WakuContext.Provider value={{ waku: stateWaku }}>\n        <Room\n          nick={nick}\n          lines={stateMessages}\n          commandHandler={(input: string) => {\n            const { command, response } = handleCommand(\n              input,\n              stateWaku,\n              setNick\n            );\n            const commandMessages = response.map((msg) => {\n              return new ChatMessage(new Date(), command, msg);\n            });\n            copyAndReplace(commandMessages, stateMessages, setMessages);\n          }}\n        />\n      </WakuContext.Provider>\n    </div>\n  );\n}\n\nasync function initWaku(setter: (waku: Waku) => void) {\n  try {\n    const waku = await Waku.create({\n      config: {\n        pubsub: {\n          enabled: true,\n          emitSelf: true,\n        },\n      },\n    });\n\n    setter(waku);\n\n    // FIXME: Connect to a go-waku instance by default, temporary hack until\n    //  we have a go-waku instance in the fleet\n    waku.libp2p.peerStore.addressBook.add(\n      PeerId.createFromB58String(\n        '16Uiu2HAmVVi6Q4j7MAKVibquW8aA27UNrA4Q8Wkz9EetGViu8ZF1'\n      ),\n      [multiaddr('/ip4/134.209.113.86/tcp/9001/ws')]\n    );\n  } catch (e) {\n    console.log('Issue starting waku ', e);\n  }\n}\n\nfunction decodeWakuMessage(data: Uint8Array): null | ChatMessage {\n  const wakuMsg = WakuMessage.decode(data);\n  if (!wakuMsg.payload) {\n    return null;\n  }\n  return ChatMessage.decode(wakuMsg.payload);\n}\n\nfunction copyAndReplace<T>(\n  newValues: Array<T>,\n  currentValues: Array<T>,\n  setter: (val: Array<T>) => void\n) {\n  const copy = currentValues.slice();\n  setter(copy.concat(newValues));\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WakuMessage = exports.DEFAULT_CONTENT_TOPIC = void 0;\n// Ensure that this class matches the proto interface while\nconst minimal_1 = require(\"protobufjs/minimal\");\n// Protecting the user from protobuf oddities\nconst message_1 = require(\"../proto/waku/v2/message\");\nexports.DEFAULT_CONTENT_TOPIC = '/waku/2/default-content/proto';\nconst DEFAULT_VERSION = 0;\nclass WakuMessage {\n    // TODO: Adopt similar design to HistoryRPC\n    constructor(payload, contentTopic, version) {\n        this.payload = payload;\n        this.contentTopic = contentTopic;\n        this.version = version;\n    }\n    static fromProto(proto) {\n        return new WakuMessage(proto.payload, proto.contentTopic, proto.version);\n    }\n    /**\n     * Create Message with a utf-8 string as payload\n     * @param payload\n     * @returns {WakuMessage}\n     */\n    static fromUtf8String(payload) {\n        const buf = Buffer.from(payload, 'utf-8');\n        return new WakuMessage(buf, exports.DEFAULT_CONTENT_TOPIC, DEFAULT_VERSION);\n    }\n    /**\n     * Create Message with a byte array as payload\n     * @param payload\n     * @param contentTopic\n     * @returns {WakuMessage}\n     */\n    static fromBytes(payload, contentTopic = exports.DEFAULT_CONTENT_TOPIC) {\n        return new WakuMessage(payload, contentTopic, DEFAULT_VERSION);\n    }\n    static decode(bytes) {\n        const wakuMsg = message_1.WakuMessageProto.decode(minimal_1.Reader.create(bytes));\n        return new WakuMessage(wakuMsg.payload, wakuMsg.contentTopic, wakuMsg.version);\n    }\n    toBinary() {\n        return message_1.WakuMessageProto.encode({\n            payload: this.payload,\n            version: this.version,\n            contentTopic: this.contentTopic,\n        }).finish();\n    }\n    utf8Payload() {\n        if (!this.payload) {\n            return '';\n        }\n        return Array.from(this.payload)\n            .map((char) => {\n            return String.fromCharCode(char);\n        })\n            .join('');\n    }\n    // Purely for tests purposes.\n    // We do consider protobuf field when checking equality\n    // As the content is held by the other fields.\n    isEqualTo(other) {\n        const payloadsAreEqual = this.payload && other.payload\n            ? Buffer.compare(this.payload, other.payload) === 0\n            : !(this.payload || other.payload);\n        return (payloadsAreEqual &&\n            this.contentTopic === other.contentTopic &&\n            this.version === other.version);\n    }\n}\nexports.WakuMessage = WakuMessage;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2FrdV9tZXNzYWdlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2xpYi93YWt1X21lc3NhZ2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsMkRBQTJEO0FBQzNELGdEQUE0QztBQUU1Qyw2Q0FBNkM7QUFDN0Msc0RBQTREO0FBRS9DLFFBQUEscUJBQXFCLEdBQUcsK0JBQStCLENBQUM7QUFDckUsTUFBTSxlQUFlLEdBQUcsQ0FBQyxDQUFDO0FBRTFCLE1BQWEsV0FBVztJQUN0QiwyQ0FBMkM7SUFDM0MsWUFDUyxPQUFvQixFQUNwQixZQUFxQixFQUNyQixPQUFnQjtRQUZoQixZQUFPLEdBQVAsT0FBTyxDQUFhO1FBQ3BCLGlCQUFZLEdBQVosWUFBWSxDQUFTO1FBQ3JCLFlBQU8sR0FBUCxPQUFPLENBQVM7SUFDdEIsQ0FBQztJQUVKLE1BQU0sQ0FBQyxTQUFTLENBQUMsS0FBdUI7UUFDdEMsT0FBTyxJQUFJLFdBQVcsQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxZQUFZLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQzNFLENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsTUFBTSxDQUFDLGNBQWMsQ0FBQyxPQUFlO1FBQ25DLE1BQU0sR0FBRyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBQzFDLE9BQU8sSUFBSSxXQUFXLENBQUMsR0FBRyxFQUFFLDZCQUFxQixFQUFFLGVBQWUsQ0FBQyxDQUFDO0lBQ3RFLENBQUM7SUFFRDs7Ozs7T0FLRztJQUNILE1BQU0sQ0FBQyxTQUFTLENBQ2QsT0FBbUIsRUFDbkIsZUFBdUIsNkJBQXFCO1FBRTVDLE9BQU8sSUFBSSxXQUFXLENBQUMsT0FBTyxFQUFFLFlBQVksRUFBRSxlQUFlLENBQUMsQ0FBQztJQUNqRSxDQUFDO0lBRUQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFpQjtRQUM3QixNQUFNLE9BQU8sR0FBRywwQkFBZ0IsQ0FBQyxNQUFNLENBQUMsZ0JBQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUM5RCxPQUFPLElBQUksV0FBVyxDQUNwQixPQUFPLENBQUMsT0FBTyxFQUNmLE9BQU8sQ0FBQyxZQUFZLEVBQ3BCLE9BQU8sQ0FBQyxPQUFPLENBQ2hCLENBQUM7SUFDSixDQUFDO0lBRUQsUUFBUTtRQUNOLE9BQU8sMEJBQWdCLENBQUMsTUFBTSxDQUFDO1lBQzdCLE9BQU8sRUFBRSxJQUFJLENBQUMsT0FBTztZQUNyQixPQUFPLEVBQUUsSUFBSSxDQUFDLE9BQU87WUFDckIsWUFBWSxFQUFFLElBQUksQ0FBQyxZQUFZO1NBQ2hDLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUNkLENBQUM7SUFFRCxXQUFXO1FBQ1QsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDakIsT0FBTyxFQUFFLENBQUM7U0FDWDtRQUVELE9BQU8sS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDO2FBQzVCLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFO1lBQ1osT0FBTyxNQUFNLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ25DLENBQUMsQ0FBQzthQUNELElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUNkLENBQUM7SUFFRCw2QkFBNkI7SUFDN0IsdURBQXVEO0lBQ3ZELDhDQUE4QztJQUM5QyxTQUFTLENBQUMsS0FBa0I7UUFDMUIsTUFBTSxnQkFBZ0IsR0FDcEIsSUFBSSxDQUFDLE9BQU8sSUFBSSxLQUFLLENBQUMsT0FBTztZQUMzQixDQUFDLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDO1lBQ25ELENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDdkMsT0FBTyxDQUNMLGdCQUFnQjtZQUNoQixJQUFJLENBQUMsWUFBWSxLQUFLLEtBQUssQ0FBQyxZQUFZO1lBQ3hDLElBQUksQ0FBQyxPQUFPLEtBQUssS0FBSyxDQUFDLE9BQU8sQ0FDL0IsQ0FBQztJQUNKLENBQUM7Q0FDRjtBQTlFRCxrQ0E4RUMifQ=="],"sourceRoot":""}